<!DOCTYPE html>
<html lang="en">
  <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
    <link rel="shortcut icon" type="image/x-icon" href="https://tech.osteel.me/favicon.ico" />

    <meta name="author" content="Yannick Chenot"/>
    <meta property="og:image" content="https://tech.osteel.me/images/2020/03/30/docker-01.jpg" />

    <meta name="google-site-verification" content="KhtQOQ0ZVgZ55KSEoXMOWo_seu_e_JbV6xBk_SuewYI" />

    <title>Docker for local web development, part 3: a three-tier architecture with frameworks &mdash; osteel's blog</title>

    <meta charset="utf-8" />
    <link href="https://tech.osteel.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Full Atom Feed" />
    <link href="https://tech.osteel.me/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog Full RSS Feed" />
    <link href="https://tech.osteel.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Atom Feed" />
    <link href="https://tech.osteel.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog RSS Feed" />
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/poole.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/syntax.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/lanyon.css"/>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/styles.css"/>

    <script
      type="text/javascript"
      src="https://platform-api.sharethis.com/js/sharethis.js#property=5e6053b434311400122fd1f8&product=inline-share-buttons"
      async="async">
    </script>




    <meta name="tags" contents="tutorial" />
    <meta name="tags" contents="docker" />
    <meta name="tags" contents="laravel" />
    <meta name="tags" contents="vuejs" />

  </head>

  <body>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="profile">
      <img src="https://www.gravatar.com/avatar/158eb527bb4ceb8e1a84e74b39815b71"/>
    </div>
  </div>

  <section>
    <p>Oh hi! I'm Yannick, a senior backend developer based in Brighton, UK.</p>
  </section>

  <section>
    <ul class="sidebar-nav">
        <li><a class="sidebar-nav-item" href="https://tech.osteel.me/pages/about">About</a></li>
    </ul>
  </section>

  <section>
    <h2>Search</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://tech.osteel.me/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
        <input class="form-input" type="text" name="q" placeholder="Search" />
    </form>
  </section>

  <section>
    <h2>Categories</h2>
    <nav class="sidebar-nav">
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/blog">Blog</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/contracting">Contracting</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/docker">Docker</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/laravel">Laravel</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/misc">Misc</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/nginx">Nginx</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/php">PHP</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/vagrant">Vagrant</a>

    </nav>
  </section>

    <section>
        <h2>Find me</h2>
        <ul class="sidebar-nav">
            <li><a class="sidebar-nav-item" href="https://www.osteel.me" target="_blank">Portfolio</a></li>
            <li><a class="sidebar-nav-item" href="https://github.com/osteel" target="_blank">GitHub</a></li>
            <li><a class="sidebar-nav-item" href="https://twitter.com/osteel" target="_blank">Twitter</a></li>
            <li><a class="sidebar-nav-item" href="https://www.linkedin.com/in/yannickchenot" target="_blank">LinkedIn</a></li>
            <li><a class="sidebar-nav-item" href="https://instagram.com/osteel" target="_blank">Instagram</a></li>
        </ul>
    </section>

  <section>
    <h2>Feeds</h2>
    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">All posts&nbsp;
        [&nbsp;
 <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a>        &nbsp;
 <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a>        &nbsp;]
      </li>
    </ul>
  </section>

  <div class="sidebar-item">
    <p>
    <a href="https://twitter.com/osteel">&copy; @osteel</a> 2020
    </p>
    <p class="tiny-note">
      Powered by <a href="http://getpelican.com">Pelican</a> :: Theme based on <a class="muted" href="https://github.com/thomaswilley/pelicanyan">Pelicanyan</a>
    </p>
  </div>
</div>    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://tech.osteel.me/" title="Home">osteel's blog</a>
            <small>Web development resources</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="posts">
<div class="post">
    <h1 class="post-title">
      Docker for local web development, part 3: a three-tier architecture with frameworks
    </h1>
    <span class="post-date">
      <small>
          Last updated: 2020-12-17 ::
        Published: 2020-03-30
          :: [ <a href="https://github.com/osteel/blog-tech-public/commits/master/posts/docker-for-local-web-development-part-3-a-three-tier-architecture-with-frameworks.html">history</a> ]
      </small>
    </span>

    <p><img alt="LEMP, Laravel and Vue.js on Docker" src="/images/2020/03/30/docker-01.jpg" title="LEMP, Laravel and Vue.js on Docker" /></p>
<h2 id="in-this-series">In this series</h2>
<ul>
<li><a href="/posts/docker-for-local-web-development-introduction-why-should-you-care" title="Docker for local web development, introduction: why should you care?">Introduction: why should you care?</a></li>
<li><a href="/posts/docker-for-local-web-development-part-1-a-basic-lemp-stack" title="Docker for local web development, part 1: a basic LEMP stack">Part 1: a basic LEMP stack</a></li>
<li><a href="/posts/docker-for-local-web-development-part-2-put-your-images-on-a-diet" title="Docker for local web development, part 2: put your images on a diet">Part 2: put your images on a diet</a></li>
<li>Part 3: a three-tier architecture with frameworks <strong>⬅️ you are here</strong></li>
<li><a href="/posts/docker-for-local-web-development-part-4-smoothing-things-out-with-bash" title="Docker for local web development, part 4: smoothing things out with Bash">Part 4: smoothing things out with Bash</a></li>
<li><a href="/posts/docker-for-local-web-development-part-5-https-all-the-things" title="Docker for local web development, part 5: HTTPS all the things">Part 5: HTTPS all the things</a></li>
<li><a href="/posts/docker-for-local-web-development-part-6-expose-a-local-container-to-the-internet" title="Docker for local web development, part 6: expose a local container to the Internet">Part 6: expose a local container to the Internet</a></li>
<li><a href="/posts/docker-for-local-web-development-part-7-using-a-multi-stage-build-to-introduce-a-worker" title="Docker for local web development, part 7: using a multi-stage build to introduce a worker">Part 7: using a multi-stage build to introduce a worker</a></li>
<li><a href="/posts/docker-for-local-web-development-part-8-scheduled-tasks" title="Docker for local web development, part 8: scheduled tasks">Part 8: scheduled tasks</a></li>
<li><a href="/posts/docker-for-local-web-development-conclusion-where-to-go-from-here" title="Docker for local web development, conclusion: where to go from here">Conclusion: where to go from here</a></li>
</ul>
<p>Subscribe to email alerts at the end of this article or follow me on <a href="https://twitter.com/osteel">Twitter</a> to be informed of new publications.</p>
<h2 id="in-this-post">In this post</h2>
<div class="toc">
<ul>
<li><a href="#in-this-series">In this series</a></li>
<li><a href="#in-this-post">In this post</a></li>
<li><a href="#foreword">Foreword</a></li>
<li><a href="#a-three-tier-architecture">A three-tier architecture?</a></li>
<li><a href="#the-backend-application">The backend application</a></li>
<li><a href="#the-frontend-application">The frontend application</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>
<h2 id="foreword">Foreword</h2>
<p>In all honesty, what we've covered so far is pretty standard. Articles about LEMP stacks on Docker are legion, and while I hope to add some value through a beginner-friendly approach and a certain level of detail, there was hardly anything new (after all, I was already writing about this <a href="/posts/from-vagrant-to-docker-how-to-use-docker-for-local-web-development" title="From Vagrant to Docker: How to use Docker for local web development">back in 2015</a>).</p>
<p>I believe this is about to change with today's article. There are many ways to manage a multitiered project with Docker, and while the approach I am about to describe certainly isn't the only one, I also think this is a subject that doesn't get much coverage at all.</p>
<p>In that sense, today's article is probably where things will start to get concrete for some of you. That is not to say the previous ones are negligible – they constitute a necessary introduction contributing to making this series comprehensive – but this is where the theory meets the practical complexity of modern web applications.</p>
<p>The assumed starting point of this tutorial is where we left things at the end of the <a href="/posts/docker-for-local-web-development-part-2-put-your-images-on-a-diet" title="Docker for local web development, part 2: put your images on a diet">previous part</a>, corresponding to the repository's <a href="https://github.com/osteel/docker-tutorial/tree/part-2"><em>part-2</em> branch</a>.</p>
<p>If you prefer, you can also directly <em>checkout</em> the <a href="https://github.com/osteel/docker-tutorial/tree/part-3"><em>part-3</em> branch</a>, which is the final result of today's article.</p>
<p>Again, this is by no means the one and only approach, just one that has been successful for me and the companies I set it up for.</p>
<h2 id="a-three-tier-architecture">A three-tier architecture?</h2>
<p>After <a href="/posts/docker-for-local-web-development-part-1-a-basic-lemp-stack" title="Docker for local web development, part 1: a basic LEMP stack">setting up a LEMP stack on Docker</a> and <a href="/posts/docker-for-local-web-development-part-2-put-your-images-on-a-diet" title="Docker for local web development, part 2: put your images on a diet">shrinking down the size of the images</a>, we are about to complement our MySQL database with a frontend application based on <a href="https://vuejs.org/">Vue.js</a> and a backend application based on <a href="https://laravel.com/">Laravel</a>, in order to form what we call a <em>three-tier architecture</em>.</p>
<p>Behind this somewhat intimidating term is a popular way to structure an application, consisting in separating the presentation layer (a.k.a. the frontend), the application layer (a.k.a. the backend) and the persistence layer (a.k.a. the database), ensuring each part is independently maintainable, deployable, scalable, and easily replaceable if need be. Each of these layers represents one tier of the three-tier architecture. And that's it!</p>
<p>In such a setup, it is common for the backend and frontend applications to each have their own repository. For simplicity's sake, however, we'll stick to a single repository in this tutorial.</p>
<h2 id="the-backend-application">The backend application</h2>
<p>Before anything else, let's get rid of the previous containers and volumes (not the images, as we still need them) by running the following command from the project's root directory:</p>
<div class="highlight"><pre><span></span>$ docker-compose down -v
</pre></div>


<p>Remember that <code>down</code> destroys the containers, and <code>-v</code> deletes the associated volumes.</p>
<p>Let's also get rid of the previous PHP-related files, to make room for the new backend application. Delete the <code>.docker/php</code> folder, the <code>.docker/nginx/conf.d/php.conf</code> file and the <code>src/index.php</code> file. Your file and directory structure should now look similar to this:</p>
<div class="highlight"><pre><span></span>docker-tutorial/
├── .docker/
│   ├── mysql/
│   │   └── my.cnf
│   └── nginx/
│       └── conf.d/
│           └── phpmyadmin.conf
├── src/
├── .env
├── .env.example
├── .gitignore
└── docker-compose.yml
</pre></div>


<p>Replace the content of <code>docker-compose.yml</code> with this one (changes have been highlighted in bold):</p>
<pre>
version: '3.7'

# Services
services:

  # Nginx Service
  nginx:
    image: nginx:1.17-alpine
    ports:
      - 80:80
    volumes:
      - ./src/backend:/var/www/backend:ro<strong>,delegated</strong>
      - ./.docker/nginx/conf.d:/etc/nginx/conf.d:ro
      - phpmyadmindata:/var/www/phpmyadmin:ro<strong>,delegated</strong>
    depends_on:
      <strong>- backend</strong>
      - phpmyadmin

  <strong># Backend Service
  backend:
    build: ./src/backend
    working_dir: /var/www/backend
    volumes:
      - ./src/backend:/var/www/backend:delegated
    depends_on:
      - mysql</strong>

  # MySQL Service
  mysql:
    image: mysql:8
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: demo
    volumes:
      - ./.docker/mysql/my.cnf:/etc/mysql/conf.d/my.cnf:ro
      - mysqldata:/var/lib/mysql<strong>:delegated</strong>

  # PhpMyAdmin Service
  phpmyadmin:
    image: phpmyadmin/phpmyadmin:5-fpm-alpine
    environment:
      PMA_HOST: mysql
    volumes:
      - phpmyadmindata:/var/www/html<strong>:delegated</strong>
    depends_on:
      - mysql

# Volumes
volumes:

  mysqldata:

  phpmyadmindata:
</pre>

<p>The biggest update is the removal of the PHP service in favour of the backend service, although they are very similar. The new service looks for a Dockerfile located in the backend application's directory (<code>src/backend</code>), which is mounted as a volume on the container. The only real difference is the appearance of <code>:delegated</code> at the end of the volume declaration.</p>
<p>This option improves <a href="https://docs.docker.com/docker-for-mac/osxfs-caching/">performance on macOS</a> by caching the content of the folder for a faster read access, which becomes necessary as the number of files grows (which is typically the case when a framework is involved). Three options are available: <code>consistent</code>, <code>cached</code> and <code>delegated</code>. I find the official documentation somewhat confusing on this, so here is another attempt at explaining them:</p>
<ul>
<li><code>consistent</code> is the option by default: it basically ensures perfect file synchronisation between the host (your local machine) and the container. This option performs poorly on macOS;</li>
<li><code>cached</code> indicates that what's in the container is more important; in other words, changes occurring on the host might not be reflected immediately in the container;</li>
<li><code>delegated</code> is the opposite of <code>cached</code>, in that the host takes precedence: changes in the container might not be reflected immediately on the host.</li>
</ul>
<p>In a development context, it is more important that our local changes are passed on to the container as soon as possible. Changes made on the host machine should therefore be prioritised, hence the <code>delegated</code> option is generally more appropriate.</p>
<p>This superficial explanation is enough for the scope of this article, but more details are available on the <a href="https://www.docker.com/blog/user-guided-caching-in-docker-for-mac/">Docker blog</a> if you are interested.</p>
<p>Note that on systems other than macOS, these options will simply be ignored, and <code>consistent</code> will be used instead.</p>
<div class="info">
<p><span class="title">Pump up that RAM!</span> If the response time still feels slow, a quick and easy trick for Docker Desktop is to increase the amount of RAM it is allowed to use. Open the preferences and adjust the <em>Memory</em> slider under <em>Resources</em>:
<img alt="Docker memory settings" src="/images/2020/03/30/docker-04.png" title="Docker memory settings">
The default value is 2 GB; I doubled that and it made a world of difference (if you've got 8 GB or more, it will most likely not impact your machine's performance in any visible way).</p>
<p>If you wish to explore further possibilities on macOS, more tips are laid out in <a href="https://engageinteractive.co.uk/blog/making-docker-faster-on-mac" title="Speeding up Docker on MacOS">this article</a>, or you could look into something like <a href="https://github.com/EugenMayer/docker-sync">docker-sync</a>, or the more recent <a href="https://docs.docker.com/docker-for-mac/mutagen/">Mutagen-based file synchronization</a>.</p>
<p>If you're on Windows and not using <a href="https://docs.docker.com/docker-for-windows/wsl/">WSL 2</a> yet, looking into it might be a good idea.</p>
</div>

<p>The rest of the changes brought to <code>docker-compose.yml</code> mostly consist of the <code>delegated</code> option being added where relevant.</p>
<p>As the backend application will be built with Laravel, let's create an Nginx server configuration based on the one provided in the <a href="https://laravel.com/docs/deployment#nginx">official documentation</a>. Create a new <code>backend.conf</code> file in <code>.docker/nginx/conf.d</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span>      <span class="mi">80</span><span class="p">;</span>
    <span class="kn">listen</span>      <span class="s">[::]:80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">backend.demo.test</span><span class="p">;</span>
    <span class="kn">root</span>        <span class="s">/var/www/backend/public</span><span class="p">;</span>

    <span class="kn">add_header</span> <span class="s">X-Frame-Options</span> <span class="s">&quot;SAMEORIGIN&quot;</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">X-XSS-Protection</span> <span class="s">&quot;1</span><span class="p">;</span> <span class="kn">mode=block&quot;</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">X-Content-Type-Options</span> <span class="s">&quot;nosniff&quot;</span><span class="p">;</span>

    <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span><span class="p">;</span>

    <span class="kn">charset</span> <span class="s">utf-8</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">/index.php?</span><span class="nv">$query_string</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="p">=</span> <span class="s">/favicon.ico</span> <span class="p">{</span> <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span> <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span> <span class="p">}</span>
    <span class="kn">location</span> <span class="p">=</span> <span class="s">/robots.txt</span>  <span class="p">{</span> <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span> <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span> <span class="p">}</span>

    <span class="kn">error_page</span> <span class="mi">404</span> <span class="s">/index.php</span><span class="p">;</span>

    <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
        <span class="kn">fastcgi_pass</span>  <span class="n">backend</span><span class="p">:</span><span class="mi">9000</span><span class="p">;</span>
        <span class="kn">fastcgi_index</span> <span class="s">index.php</span><span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">SCRIPT_FILENAME</span> <span class="nv">$realpath_root$fastcgi_script_name</span><span class="p">;</span>
        <span class="kn">include</span>       <span class="s">fastcgi_params</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="p">~</span> <span class="sr">/\.(?!well-known).*</span> <span class="p">{</span>
        <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Mind the values for <code>server_name</code> and <code>fastcgi_pass</code> (now pointing to port 9000 of the backend container).</p>
<p class="info"><span class="title">Why not use Laravel Sail?</span> If you're already a Laravel developer, you might have come across <a href="https://laravel.com/docs/sail">Sail</a>, Laravel's official Docker-based development environment. While their approach is similar to this series' in many ways, the main difference is that Sail is meant to cater for Laravel monoliths only. In other words, Sail is meant for applications that are fully encompassed within Laravel, as opposed to applications where the Laravel bit is only one component among others, which is the case in this series.</p>

<p>You also need to update your local <code>hosts</code> file with the new domain names (have a quick look <a href="/posts/docker-for-local-web-development-part-1-a-basic-lemp-stack#domain-name" title="Docker for local web development, part 1: a basic LEMP stack">here</a> if you've forgotten how to do that):</p>
<div class="highlight"><pre><span></span><span class="m">127</span>.0.0.1 backend.demo.test frontend.demo.test phpmyadmin.test
</pre></div>


<p>Note that we've also added the frontend's domain to save us a trip later.</p>
<p>Create the <code>src/backend</code> directory and add a Dockerfile with the following content to it:</p>
<div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> php:7.4-fpm-alpine</span>
</pre></div>


<p>Your file structure should now look like this:</p>
<div class="highlight"><pre><span></span>docker-tutorial/
├── .docker/
│   ├── mysql/
│   │   └── my.cnf
│   └── nginx/
│       └── conf.d/
│           └── backend.conf
│           └── phpmyadmin.conf
├── src/
│   └── backend/
│       └── Dockerfile
├── .env
├── .env.example
├── .gitignore
└── docker-compose.yml
</pre></div>


<p>Laravel requires <a href="https://laravel.com/docs/installation#server-requirements">a few PHP extensions</a> to function properly, so we need to ensure those are installed. The Alpine version of the PHP image comes with a number of pre-installed extensions which we can list by running the following command (from the project's root, as usual):</p>
<div class="highlight"><pre><span></span>$ docker-compose run --rm backend php -m
</pre></div>


<p>Now if you remember, in the first part of this series we used <code>exec</code> to run Bash on a container, whereas this time we are using <code>run</code> to execute the command we need. What's the difference?</p>
<p><code>exec</code> simply allows us to execute a command on an <em>already running</em> container, whereas <code>run</code> does so on a <em>new</em> container which is immediately stopped after the command is over. It does not delete the container by default, however; we need to specify <code>--rm</code> after <code>run</code> for it to happen.</p>
<p>The command essentially runs <code>php -m</code> on the backend container, and gives the following result:</p>
<div class="highlight"><pre><span></span><span class="o">[</span>PHP Modules<span class="o">]</span>
Core
ctype
curl
date
dom
fileinfo
filter
ftp
<span class="nb">hash</span>
iconv
json
libxml
mbstring
mysqlnd
openssl
pcre
PDO
pdo_sqlite
Phar
posix
readline
Reflection
session
SimpleXML
sodium
SPL
sqlite3
standard
tokenizer
xml
xmlreader
xmlwriter
zlib

<span class="o">[</span>Zend Modules<span class="o">]</span>
</pre></div>


<p>That is quite a lot of extensions, which might come as a surprise after reading the <a href="/posts/docker-for-local-web-development-part-2-put-your-images-on-a-diet" title="Docker for local web development, part 2: put your images on a diet">previous part</a> praising Alpine images for featuring the bare minimum by default. The reason is also hinted at in the previous article: since it is not always simple to install things on an Alpine distribution, the PHP image's maintainers chose to make their users' lives easier by preinstalling a bunch of extensions.</p>
<p>The final result is around 80 MB, which is still very small.</p>
<p>Now that we know which extensions are missing, we can complete the Dockerfile to install them, along with <a href="https://getcomposer.org/">Composer</a> which is needed for Laravel:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> php:7.4-fpm-alpine</span>

<span class="c"># Install extensions</span>
<span class="k">RUN</span> docker-php-ext-install pdo_mysql bcmath

<span class="c"># Install Composer</span>
<span class="k">COPY</span> --from<span class="o">=</span>composer:latest /usr/bin/composer /usr/local/bin/composer
</pre></div>
</td></tr></table>

<p>Here we're leveraging <a href="https://docs.docker.com/develop/develop-images/multistage-build/#use-multi-stage-builds">multi-stage builds</a> (more specifically, <a href="https://docs.docker.com/develop/develop-images/multistage-build/#use-an-external-image-as-a-stage">using an external image as a stage</a>) to get Composer's latest version from the <a href="https://hub.docker.com/_/composer">Composer Docker image</a> directly (we'll talk more about multi-stage builds in <a href="/posts/docker-for-local-web-development-part-7-using-a-multi-stage-build-to-introduce-a-worker" title="Docker for local web development, part 7: using a multi-stage build to introduce a worker">part 7</a>).</p>
<p>Updating the Dockerfile means we need to rebuild the image:</p>
<div class="highlight"><pre><span></span>$ docker-compose build backend
</pre></div>


<p>Once this is done, run the following command:</p>
<div class="highlight"><pre><span></span>$ docker-compose run --rm backend composer create-project --prefer-dist laravel/laravel tmp <span class="s2">&quot;8.*&quot;</span>
</pre></div>


<p>This will use the version of Composer installed on the backend container (no need to install Composer locally!) to create a new Laravel 8 project in the container's <code>/var/www/backend/tmp</code> folder.</p>
<p>As per <code>docker-compose.yml</code>, the container's working directory is <code>/var/www/backend</code>, onto which the local folder <code>src/backend</code> was mounted – if you look into that directory now on your local machine, you will find a new <code>tmp</code> folder containing the files of a fresh Laravel application. But why did we not create the project in <code>backend</code> directly?</p>
<p>Behind the scenes, <code>composer create-project</code> performs a <code>git clone</code>, and that won't work if the target directory is not empty. In our case, <code>backend</code> already contains the Dockerfile, which is necessary to run the command in the first place. We essentially created the <code>tmp</code> folder as a temporary home for our project, and we now need to move back the files to their final location:</p>
<div class="highlight"><pre><span></span>$ docker-compose run --rm backend sh -c <span class="s2">&quot;mv -n tmp/.* ./ &amp;&amp; mv tmp/* ./ &amp;&amp; rm -Rf tmp&quot;</span>
</pre></div>


<p>This will run the content between the double quotes on the container, <code>sh -c</code> basically being a trick allowing us to run more than a single command at once (if we ran <code>docker-compose run --rm backend mv -n tmp/.* ./ &amp;&amp; mv tmp/* ./ &amp;&amp; rm -Rf tmp</code> instead, only the first <code>mv</code> instruction would be executed on the container, and the rest would be run on the local machine).</p>
<div class="info">
<p><span class="title">Shouldn't Composer be in its own container?</span> A popular way to deal with package managers is to isolate them into their own containers, the main reason being that they are external tools mostly used during development and that they've got no business shipping with the application itself (which is all correct).</p>
<p>I actually used this approach for a while, but it comes with downsides that are often overlooked: as Composer allows developers to specify a package's requirements (necessary PHP extensions, PHP's minimum version, etc.), by default it will check the system on which it installs the application's dependencies to make sure it meets those criteria. In practice, this means the configuration of the container hosting Composer must be as close as possible to the application's, which often means doubling the work for the maintainer. As a result, some people choose to run Composer with the <code>--ignore-platform-reqs</code> flag instead, ensuring dependencies will always install regardless of the system's configuration.</p>
<p>This is a dangerous thing to do: while most of the time dependency-related errors will be spotted during development, in some instances the problem could go unnoticed until someone stumbles upon it, either on staging or even in production (this is especially true if your application does't have full test coverage). Moreover, staged builds are an effective way to separate the package manager from the application in a single Dockerfile, but that's a topic I will broach later in this series. Bear with!</p>
</div>

<p>By default, Laravel has created a <code>.env</code> file for you, but let's replace its content with this one (you will find this file under <code>src/backend</code>):</p>
<div class="highlight"><pre><span></span><span class="nv">APP_NAME</span><span class="o">=</span>demo
<span class="nv">APP_ENV</span><span class="o">=</span><span class="nb">local</span>
<span class="nv">APP_KEY</span><span class="o">=</span>base64:BcvoJ6dNU/I32Hg8M8IUc4M5UhGiqPKoZQFR804cEq8<span class="o">=</span>
<span class="nv">APP_DEBUG</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">APP_URL</span><span class="o">=</span>http://backend.demo.test

<span class="nv">LOG_CHANNEL</span><span class="o">=</span>single

<span class="nv">DB_CONNECTION</span><span class="o">=</span>mysql
<span class="nv">DB_HOST</span><span class="o">=</span>mysql
<span class="nv">DB_PORT</span><span class="o">=</span><span class="m">3306</span>
<span class="nv">DB_DATABASE</span><span class="o">=</span>demo
<span class="nv">DB_USERNAME</span><span class="o">=</span>root
<span class="nv">DB_PASSWORD</span><span class="o">=</span>root

<span class="nv">BROADCAST_DRIVER</span><span class="o">=</span>log
<span class="nv">CACHE_DRIVER</span><span class="o">=</span>file
<span class="nv">QUEUE_CONNECTION</span><span class="o">=</span>sync
<span class="nv">SESSION_DRIVER</span><span class="o">=</span>file
</pre></div>


<p>Not much to see here, apart from the database configuration (mind the value of <code>DB_HOST</code>) and some standard application settings.</p>
<p>Let's try out our new setup:</p>
<div class="highlight"><pre><span></span>$ docker-compose up -d
</pre></div>


<p>Once it is up, visit <a href="http://backend.demo.test">backend.demo.test</a>; if all went well, you should see Laravel's home page:</p>
<p><img alt="Laravel home" src="/images/2020/03/30/docker-02.png" title="Laravel home" /></p>
<p>Let's also verify our database settings by running Laravel's default migrations:</p>
<div class="highlight"><pre><span></span>$ docker-compose <span class="nb">exec</span> backend php artisan migrate
</pre></div>


<p>You can log into <a href="http://phpmyadmin.test">phpmyadmin.test</a> (with the <code>root</code> / <code>root</code> credentials) to confirm the presence of the <code>demo</code> database and its newly created tables (<code>users</code>, <code>password_resets</code> and <code>failed_jobs</code>).</p>
<p>There is one last thing we need to do before moving on to the frontend application: since our aim is to have it interact with the backend, let's add the following endpoint to <code>routes/api.php</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="c1">// ignore this line, it&#39;s for syntax highlighting only</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/hello-there&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;General Kenobi&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>Try it out by accessing <a href="http://backend.demo.test/api/hello-there">backend.demo.test/api/hello-there</a>, which should display "General Kenobi".</p>
<p>Our API is ready!</p>
<p>We are done for this section but, if you wish to experiment further, while the backend's container is up you can run Artisan and Composer commands like this:</p>
<div class="highlight"><pre><span></span>$ docker-compose <span class="nb">exec</span> backend php artisan
$ docker-compose <span class="nb">exec</span> backend composer
</pre></div>


<p>And if it's not running:</p>
<div class="highlight"><pre><span></span>$ docker-compose run --rm backend php artisan
$ docker-compose run --rm backend composer
</pre></div>


<h2 id="the-frontend-application">The frontend application</h2>
<p>The third tier of our architecture is the frontend application, for which we will use the ever more popular <a href="https://vuejs.org">Vue.js</a>.</p>
<p>The steps to set it up are actually quite similar to the backend's; first, let's add the corresponding service to <code>docker-compose.yml</code>, right after the backend one:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Frontend Service</span>
<span class="nt">frontend</span><span class="p">:</span>
  <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/frontend</span>
  <span class="nt">working_dir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/www/frontend</span>
  <span class="nt">volumes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/frontend:/var/www/frontend:delegated</span>
  <span class="nt">depends_on</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">backend</span>
</pre></div>
</td></tr></table>

<p>Nothing that we haven't seen before here. We also need to specify in the Nginx service that the frontend service should be started first:</p>
<pre>
# Nginx Service
nginx:
  image: nginx:1.17-alpine
  ports:
    - 80:80
  volumes:
    - ./src/backend:/var/www/backend:ro,delegated
    - ./.docker/nginx/conf.d:/etc/nginx/conf.d:ro
    - phpmyadmindata:/var/www/phpmyadmin:ro,delegated
  depends_on:
    - backend
    - phpmyadmin
    <strong>- frontend</strong>
</pre>

<p>Then, create a new <code>frontend</code> folder under <code>src</code> and add the following Dockerfile to it:</p>
<div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> node:13.10-alpine</span>
</pre></div>


<p>We simply pull the Alpine version of <a href="https://hub.docker.com/_/node">Node.js' official image</a> for now, which ships with both <a href="https://yarnpkg.com/">Yarn</a> and <a href="https://www.npmjs.com/">npm</a> (which are package managers like Composer, but for JavaScript). I will be using Yarn, as I am told this is what the cool kids use nowadays.</p>
<p>Let's build the image:</p>
<div class="highlight"><pre><span></span>$ docker-compose build frontend
</pre></div>


<p>Once the image is ready, create a fresh Vue.js project with the following command:</p>
<div class="highlight"><pre><span></span>$ docker-compose run --rm frontend sh -c <span class="s2">&quot;yarn global add @vue/cli &amp;&amp; vue create tmp --default --force&quot;</span>
</pre></div>


<p>By using the same <code>sh -c</code> trick as earlier in order to run multiple commands at once on the container, we install <a href="https://cli.vuejs.org/">Vue CLI</a> (<code>yarn global add @vue/cli</code>) and use it straight away to <a href="https://cli.vuejs.org/guide/creating-a-project.html#vue-create">create a new Vue.js project</a> with some default presets, in the <code>tmp</code> directory (<code>vue create tmp --default --force</code>). This directory is located under <code>/var/www/frontend</code> , which is the container's working directory as per <code>docker-compose.yml</code>.</p>
<p>We don't install Vue CLI via the Dockerfile here, because the only use we have for it is to create the project. Once that's done, there's no need to keep it around.</p>
<p>Just like the backend, let's move the files out of <code>tmp</code> and back to the parent directory:</p>
<div class="highlight"><pre><span></span>$ docker-compose run --rm frontend sh -c <span class="s2">&quot;mv -n tmp/.* ./ &amp;&amp; mv tmp/* ./ &amp;&amp; rm -Rf tmp&quot;</span>
</pre></div>


<p>If all went well, you will find the application's files under <code>src/frontend</code> on your local machine.</p>
<p>We've already added <code>frontend.demo.test</code> to the <code>hosts</code> file earlier, so let's move on to creating the Nginx server configuration. Add a new <code>frontend.conf</code> file to <code>.docker/nginx/conf.d</code>, with the following content (most of the <code>location</code> block comes from <a href="https://medium.com/@robertz/nginx-vuejs-and-express-with-docker-4177cb506fbf">this article</a>):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span>      <span class="mi">80</span><span class="p">;</span>
    <span class="kn">listen</span>      <span class="s">[::]:80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">frontend.demo.test</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span>         <span class="s">http://frontend:8080</span><span class="p">;</span>
        <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span>   <span class="s">Upgrade</span> <span class="nv">$http_upgrade</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span>   <span class="s">Connection</span> <span class="s">&#39;upgrade&#39;</span><span class="p">;</span>
        <span class="kn">proxy_cache_bypass</span> <span class="nv">$http_upgrade</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span>   <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>This simple configuration redirects the traffic from the domain name's port 80 to the container's port 8080, which is the port Vue.js uses for its <a href="https://cli.vuejs.org/guide/cli-service.html#using-the-binary">development server</a>.</p>
<p>Let's also add a new <code>vue.config.js</code> file in <code>src/frontend</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">devServer</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">disableHostCheck</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">sockHost</span><span class="o">:</span> <span class="s1">&#39;frontend.demo.test&#39;</span><span class="p">,</span>
        <span class="nx">watchOptions</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">ignored</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
            <span class="nx">aggregateTimeout</span><span class="o">:</span> <span class="mi">300</span><span class="p">,</span>
            <span class="nx">poll</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<p>This will ensure the <em>hot-reload</em> feature is functional. I won't go into details about each option here, as the point is not so much about configuring Vue.js as seeing how to articulate a frontend and a backend application with Docker, regardless of the chosen frameworks. You are welcome to <a href="https://cli.vuejs.org/config/">look them up</a> though!</p>
<p>Let's complete our Dockerfile by adding the command that will start the development server:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> node:13.10-alpine</span>

<span class="c"># Start application</span>
<span class="k">CMD</span> <span class="p">[</span><span class="s2">&quot;yarn&quot;</span><span class="p">,</span> <span class="s2">&quot;serve&quot;</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<p>Rebuild the image:</p>
<div class="highlight"><pre><span></span>$ docker-compose build frontend
</pre></div>


<p>And start the project so Docker picks up the image changes (for some reason, the <code>restart</code> command won't do that):</p>
<div class="highlight"><pre><span></span>$ docker-compose start
</pre></div>


<p>Once everything is up and running, access <a href="http://frontend.demo.test">frontend.demo.test</a> and you should see Vue.js' welcome page:</p>
<p><img alt="Vue.js home" src="/images/2020/03/30/docker-03.png" title="Vue.js home" /></p>
<p>Give it a minute if it doesn't show up immediately, as the server takes some time to start. If need be, you can monitor it with the following command:</p>
<div class="highlight"><pre><span></span>$ docker-compose logs -f frontend
</pre></div>


<p>Open <code>src/frontend/src/components/HelloWorld.vue</code> and update some content (one of the <code>&lt;h3&gt;</code> tags, for example). Go back to your browser and you should see the change happen in real time: this is hot-reload doing its magic!</p>
<p>To make sure our setup is complete, all we've got left to do is to query the API endpoint we defined earlier in the backend, with the help of <a href="https://github.com/axios/axios">Axios</a>. Let's install the package with the following command:</p>
<div class="highlight"><pre><span></span>$ docker-compose <span class="nb">exec</span> frontend yarn add axios
</pre></div>


<p>While Yarn is doing its thing, let's replace the content of <code>src/frontend/src/App.vue</code> with this one:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;app&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">HelloThere</span> <span class="na">:msg</span><span class="o">=</span><span class="s">&quot;msg&quot;</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="nx">axios</span>      <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span>
<span class="kr">import</span> <span class="nx">HelloThere</span> <span class="nx">from</span> <span class="s1">&#39;./components/HelloThere.vue&#39;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;App&#39;</span><span class="p">,</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">HelloThere</span>
  <span class="p">},</span>
  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">msg</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">axios</span>
      <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://backend.demo.test/api/hello-there&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>All we are doing here is hitting the <code>hello-there</code> endpoint we created earlier and assigning its response to the <code>msg</code> property, which is passed on to the <code>HelloThere</code> component. Once again I won't linger too much on this, as this is not a Vue.js tutorial – I merely use it as an example.</p>
<p>Delete <code>src/frontend/src/components/HelloWorld.vue</code>, and create a new <code>HelloThere.vue</code> file in its place:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://tech.osteel.me/images/2020/03/04/hello.gif&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Hello there&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;center&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ msg }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;HelloThere&#39;</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">msg</span><span class="o">:</span> <span class="nb">String</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="nt">p</span> <span class="p">{</span>
  <span class="k">font-family</span><span class="p">:</span> <span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
  <span class="k">font-size</span><span class="p">:</span> <span class="mi">90</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">center</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
  <span class="k">margin-left</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
  <span class="k">margin-right</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>The component contains a little bit of HTML and CSS code, and displays the value of <code>msg</code> in a <code>&lt;p&gt;</code> tag.</p>
<p>Save the file and go back to your browser: the content of our API endpoint's response should now display at the bottom of the page.</p>
<p><img alt="Hello There" src="/images/2020/03/30/docker-05.png" title="Hello There" /></p>
<p>If you want to experiment further, while the frontend's container is up you can run Yarn commands like this:</p>
<div class="highlight"><pre><span></span>$ docker-compose <span class="nb">exec</span> frontend yarn
</pre></div>


<p>And if it's not running:</p>
<div class="highlight"><pre><span></span>$ docker-compose run --rm frontend yarn
</pre></div>


<div class="info">
<p><span class="title">Using separate repositories</span> As I mentioned at the beginning of this article, in a real-life situation the frontend and backend applications are likely to be in their own repositories, and the Docker environment in a third one. How to articulate the three of them?</p>
<p>The way I do it is by adding the <code>src</code> folder to the <code>.gitignore</code> file at the root, and I <em>checkout</em> both the frontend and backend applications in it, in separate directories. And that's about it! Since <code>src</code> is <em>git-ignored</em>, you can safely <em>checkout</em> other codebases in it, without conflicts. Theoretically, you could also use <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">Git submodules</a> to achieve this, but in practice it adds little to no value, especially when applying what we'll cover in the next part.</p>
</div>

<h2 id="conclusion">Conclusion</h2>
<p>That was another long one, well done if you made it this far!</p>
<p>This article once again underscores the fact that, when it comes to building such an environment, a lot is left to the maintainer's discretion. There is seldom any clear way of doing things with Docker, which is both a strength and a weakness – a somewhat overwhelming flexibility. These little detours contribute to making these articles dense, but I think it is important for you to know that you are allowed to question the way things are done.</p>
<p>On the same note, you might also start to wonder about the practicality of such an environment, with the numerous commands and syntaxes one needs to remember to navigate it properly. And you would be right. That is why the <a href="/posts/docker-for-local-web-development-part-4-smoothing-things-out-with-bash" title="Docker for local web development, part 4: smoothing things out with Bash">next article</a> will be about using Bash to abstract away some of that complexity, to introduce a nicer, more user-friendly interface in its place.</p>
<p>You can subscribe to email alerts below to make sure you don't miss it, or you can also follow me on <a href="https://twitter.com/osteel">Twitter</a> where I will share my posts as soon as they are published.</p>

    <p class="meta">
      <small>
        Last updated by osteel on the
          <time datetime="2020-12-17" pubdate>2020-12-17</time>
          :: [
          <a href="https://tech.osteel.me/tag/tutorial">tutorial</a>
          <a href="https://tech.osteel.me/tag/docker">docker</a>
          <a href="https://tech.osteel.me/tag/laravel">laravel</a>
          <a href="https://tech.osteel.me/tag/vuejs">vuejs</a>
          ]
      </small>
    </p>

    <div class="sharethis-inline-share-buttons"></div>

    <section>
      <h2>Enjoying the content?</h2>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
        <p class="tiny-note">You can unsubscribe at any time by clicking the link in the footer of the emails.<br>By clicking to subscribe, you acknowledge that your email address will be transferred to Mailchimp for processing.<br>Learn more about Mailchimp's privacy practices <a href="https://mailchimp.com/legal/" target="_blank">here</a>.</p>
      </form>
    </section>

    <section>
      <h2>Comments</h2>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
    </section>
  </div>
</div>
      </div>

      <label for="sidebar-checkbox" class="sidebar-toggle"></label>

      <script>
        (function(document) {
          var i = 0;
          // snip empty header rows since markdown can't
          var rows = document.querySelectorAll('tr');
          for(i=0; i<rows.length; i++) {
            var ths = rows[i].querySelectorAll('th');
            var rowlen = rows[i].children.length;
            if (ths.length > 0 && ths.length === rowlen) {
              rows[i].remove();
            }
          }
        })(document);
      </script>

      <script>
        /* Lanyon & Poole are Copyright (c) 2014 Mark Otto. Adapted to Pelican 20141223 and extended a bit by @thomaswilley */
        (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');
          document.addEventListener('click', function(e) {
            var target = e.target;
            if(!checkbox.checked ||
            sidebar.contains(target) ||
            (target === checkbox || target === toggle)) return;
            checkbox.checked = false;
            }, false);
            })(document);
      </script>


      <script type="text/javascript">
        var disqus_shortname = "osteel";
              var disqus_identifier = "/posts/docker-for-local-web-development-part-3-a-three-tier-architecture-with-frameworks";
              var disqus_url = "https://tech.osteel.me/posts/docker-for-local-web-development-part-3-a-three-tier-architecture-with-frameworks";
              var disqus_title = "Docker for local web development, part 3: a three-tier architecture with frameworks";
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
      </script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53994673-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53994673-2');
    ga('send', 'pageview');
</script>

     </div>
  </body>
</html>