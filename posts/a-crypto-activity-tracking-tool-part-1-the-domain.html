<!DOCTYPE html>
<html lang="en">
  <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
    <link rel="shortcut icon" type="image/x-icon" href="https://tech.osteel.me/favicon.ico" />

    <meta name="author" content="Yannick Chenot"/>
    <meta property="og:image" content="https://tech.osteel.me/images/2022/08/17/dime_01.jpg" />

    <meta name="google-site-verification" content="KhtQOQ0ZVgZ55KSEoXMOWo_seu_e_JbV6xBk_SuewYI" />

    <meta name="monetization" content="$ilp.uphold.com/miU94ZyFdQ6K">

    <title>Building a PHP CLI tool using DDD and Event Sourcing. Part 1: the domain &mdash; osteel's blog</title>

    <meta charset="utf-8" />
    <link href="https://tech.osteel.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Full Atom Feed" />
    <link href="https://tech.osteel.me/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog Full RSS Feed" />
    <link href="https://tech.osteel.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Atom Feed" />
    <link href="https://tech.osteel.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog RSS Feed" />
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/poole.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/syntax.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/lanyon.css"/>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/styles.css"/>

    <script
      type="text/javascript"
      src="https://platform-api.sharethis.com/js/sharethis.js#property=5e6053b434311400122fd1f8&product=inline-share-buttons"
      async="async">
    </script>



  <meta name="description" content="We continue our exploration of DDD with the expression of the domain. A domain is a group of related concepts and ideas about a field, articulated by experts in that field. Expressing the domain is a way to get familiar with its lexical field and to start building the ubiquitous language, the language to be used consistently in the model and across all communications." />
  <meta name="twitter:description" content="We continue our exploration of DDD with the expression of the domain. A domain is a group of related concepts and ideas about a field, articulated by experts in that field. Expressing the domain is a way to get familiar with its lexical field and to start building the ubiquitous language, the language to be used consistently in the model and across all communications.">

  <meta name="tags" content="ddd" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@osteel">
  <meta name="twitter:creator" content="@osteel">
  <meta name="twitter:title" content="Building a PHP CLI tool using DDD and Event Sourcing. Part 1: the domain">
  <meta name="twitter:image" content="https://tech.osteel.me/images/2022/08/17/dime_01.jpg">

  </head>

  <body>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="profile">
      <img src="https://www.gravatar.com/avatar/158eb527bb4ceb8e1a84e74b39815b71"/>
    </div>
  </div>

  <section>
    <p>Demat ! I'm Yannick, a senior backend developer based in Brighton, UK.</p>
  </section>

  <section>
    <ul class="sidebar-nav">
    </ul>
  </section>

  <section>
    <h2>Newsletter</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
      <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="Email address" required>
      <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
      <input type="submit" hidden />
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
    </form>
  </section>

  <section>
    <h2>Categories</h2>
    <nav class="sidebar-nav">
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/blogging">Blogging</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/business">Business</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/devops">DevOps</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/laravel">Laravel</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/misc">Misc</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/news">News</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/php">PHP</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/productivity">Productivity</a>

    </nav>
  </section>

  <section>
    <h2>Search</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://tech.osteel.me/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
        <input class="form-input" type="text" name="q" placeholder="Search" />
    </form>
  </section>

    <section>
        <h2>Find me</h2>
        <ul class="sidebar-nav">
            <li><a class="sidebar-nav-item" href="https://github.com/osteel" target="_blank">GitHub</a></li>
            <li><a class="sidebar-nav-item" href="https://twitter.com/osteel" target="_blank">Twitter</a></li>
            <li><a class="sidebar-nav-item" href="https://www.linkedin.com/in/yannickchenot" target="_blank">LinkedIn</a></li>
        </ul>
    </section>

  <section>
    <h2>Feeds</h2>
    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">All posts&nbsp;
        [&nbsp;
 <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a>        &nbsp;
 <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a>        &nbsp;]
      </li>
    </ul>
  </section>

  <div class="sidebar-item">
    <p>
    <a href="https://twitter.com/osteel">&copy; @osteel</a> 2023
    </p>
    <p class="tiny-note">
      Powered by <a href="http://getpelican.com">Pelican</a> :: Theme based on <a class="muted" href="https://github.com/thomaswilley/pelicanyan">Pelicanyan</a>
    </p>
  </div>
</div>    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://tech.osteel.me/" title="Home">osteel's blog</a>
            <small>Web development resources</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="posts">
<div class="post">
    <h1 class="post-title">
      Building a PHP CLI tool using DDD and Event Sourcing. Part 1: the domain
    </h1>
    <span class="post-date">
      <small>
          Last updated: 2022-12-04 ::
        Published: 2022-08-17
          :: [ <a href="https://github.com/osteel/blog-tech-public/commits/master/posts/a-crypto-activity-tracking-tool-part-1-the-domain.html">history</a> ]
      </small>
    </span>

    <section class="info">
      <span class="title">Been here before?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p><img alt="People in a meeting" src="/images/2022/08/17/dime_01.jpg" title="Photo by Jason Goodman Unsplash" />
<p class="caption">Time to sit with the experts (photo by <a href="https://unsplash.com/@jasongoodman_youxventures?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Jason Goodman</a> on <a href="https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>)</p></p>
<p>The first D of DDD stands for <em>Domain</em>. This is where we start.</p>
<p>The word <em>domain</em> can mean a number of things, but in the context of DDD and of this series, we'll use two definitions from <a href="https://en.wiktionary.org/wiki/domain">Wiktionary</a>:</p>
<blockquote>
<p>1) A field or sphere of activity, influence or expertise<br />
2) A group of related items, topics, or subjects</p>
</blockquote>
<p>While these definitions are still fairly loose, they encompass the main ideas behind the type of domain we're trying to identify – a group of related concepts and ideas about a field, articulated by experts in that field.</p>
<h2 id="in-this-series">In this series</h2>
<ul>
<li><a href="/posts/a-crypto-activity-tracking-tool-introduction-why" title="Building a PHP CLI tool using DDD and Event Sourcing. Introduction: why?">Introduction: why?</a></li>
<li>Part 1: the domain  <strong>⬅️ you are here</strong></li>
<li><a href="/posts/a-crypto-activity-tracking-tool-part-2-the-model" title="Building a PHP CLI tool using DDD and Event Sourcing. Part 2: the model">Part 2: the model</a></li>
<li>Part 3: code design <em>(coming soon)</em></li>
</ul>
<h2 id="in-this-post">In this post</h2>
<div class="toc">
<ul>
<li><a href="#in-this-series">In this series</a></li>
<li><a href="#in-this-post">In this post</a></li>
<li><a href="#what-is-the-domain-for">What is the domain for?</a></li>
<li><a href="#who-are-the-experts">Who are the experts?</a></li>
<li><a href="#the-domain">The domain</a><ul>
<li><a href="#the-basics">The basics</a></li>
<li><a href="#trading">Trading?</a></li>
<li><a href="#fiat-conversions">Fiat conversions</a></li>
<li><a href="#buying-and-selling">Buying and selling</a></li>
<li><a href="#selling-an-asset-for-fiat-currency">Selling an asset for fiat currency</a></li>
<li><a href="#exchanging-an-asset-for-another-asset">Exchanging an asset for another asset</a></li>
<li><a href="#using-an-asset-to-purchase-goods-and-services">Using an asset to purchase goods and services</a></li>
<li><a href="#fees-in-fiat">Fees in fiat</a></li>
<li><a href="#fees-in-cryptocurrency">Fees in cryptocurrency</a></li>
<li><a href="#decentralised-finance">Decentralised Finance</a></li>
<li><a href="#non-fungible-tokens">Non-Fungible Tokens</a></li>
<li><a href="#airdrops">Airdrops</a></li>
<li><a href="#hard-forks">Hard forks</a></li>
<li><a href="#gifts">Gifts</a></li>
</ul>
</li>
<li><a href="#closing-thoughts">Closing thoughts</a></li>
</ul>
</div>
<h2 id="what-is-the-domain-for">What is the domain for?</h2>
<p>The process roughly goes like this – domain experts describe what they do and go through the rules applying to various scenarios, guided by our questions and what we aim to achieve with the software. The goal is to gather as much information as possible to later try and identify the key concepts of the domain.</p>
<p>Expressing the domain is also a way to get familiar with its lexical field, to remove ambiguity from terms that may eventually find their way to the model. In doing so, we lay the foundation of the <em>ubiquitous language</em>, the language to be used consistently across all communications, both by the team and the experts.</p>
<p>The result won't be 100% complete nor correct, but it's a starting point. The next phases – modelling and code design – will help further determine what bits of information are important and what can be ignored. Sometimes, these steps will uncover elements missing from the domain, which we will need to amend with the help of the experts.</p>
<p>In turn, these new elements will reshape the model and flow into the code, each phase feeding into the others, creating a feedback loop in which each iteration gets us closer to the truth.</p>
<h2 id="who-are-the-experts">Who are the experts?</h2>
<p>A key element of DDD is to identify the relevant experts. When it comes to the tool serving as a backdrop for this series, one group of professionals naturally comes to mind – accountants. They know the rules that apply to crypto transactions and can confirm whether the implemented logic yields the correct results.</p>
<p>As rule issuers, another essential group of experts is <a href="https://www.gov.uk/government/organisations/hm-revenue-customs">HMRC</a> – the UK Government's department responsible for the collection of taxes. While I am not in direct contact with an HMRC agent, there is a fairly comprehensive <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual">Cryptoassets Manual</a> available online for anyone to consult.</p>
<p>But in this case, there's also a third, less obvious expert that can inform the domain – myself. I want to write a program that reflects my crypto activity, of which I'm an "expert" of some sort. I know the types of transactions I need to ask about, allowing me to guide the conversation so that, together with the other experts, we express a subset of the domain that is relevant to the future software.</p>
<p>To facilitate this, I laid out the use cases I was particularly interested in, preemptively narrowing down the domain. I sent those use cases to my accountant, who explained the applicable rules and, later on, confirmed whether the example calculations I had submitted were correct.</p>
<h2 id="the-domain">The domain</h2>
<p>So what are those use cases? I've listed them below, with some context and illustrative examples. Together with some more general aspects of the UK tax regime, they constitute the domain.</p>
<p>Note that it isn't set in stone. It is very likely that as the field of crypto and web3 expands, so too will my crypto activity, forcing me to revisit the domain, complete the model and update its implementation.</p>
<p>HMRC rules are also likely to evolve, prompting similar changes.</p>
<p class="warning"><span class="title">Disclaimer</span> The below is correct to the best of my knowledge and I implemented the corresponding rules accordingly. But I am not an accountant and therefore cannot guarantee the complete accuracy of the following examples at any given time. Please speak to a professional before using this material for tax purposes.</p>

<h3 id="the-basics">The basics</h3>
<p>We need to cover a few basics before digging into specific use cases.</p>
<p>First, in the UK the <em>fiscal year</em> or <em>tax year</em> runs from <a href="https://www.gov.uk/self-assessment-tax-returns/deadlines">April 6 to April 5</a>.</p>
<p>Second, most types of taxes have an <em>allowance</em> under which proceeds are tax-free. For instance, the 2022-23 tax year has the following allowances:</p>
<ul>
<li>the <em>Income Tax</em> doesn't apply <a href="https://www.gov.uk/income-tax-rates">to the first £12570 of revenue</a>;</li>
<li>the <em>Capital Gains Tax</em> doesn't apply <a href="https://www.gov.uk/capital-gains-tax/allowances">to the first £12300 of capital gains</a>.</li>
</ul>
<p>In the examples below, it is implied that these tax regimes only apply to amounts greater than the allowances.</p>
<p>Finally, a high-level way to describe what we're trying to achieve here is that we intend to analyse a bunch of <em>transactions</em> in chronological order so we can extract and output information that can be used for tax purposes.</p>
<h3 id="trading">Trading?</h3>
<p>Something else that we need to get out of the way before we get to the nitty-gritty of crypto tax rules is whether one's crypto activity is considered to be <em>trading</em>:</p>
<blockquote>
<p>Only in exceptional circumstances would HMRC expect individuals to buy and sell exchange tokens with such frequency, level of organisation and sophistication that the activity amounts to a financial trade in itself. If the taxpayer’s activity is considered to be trading then Income Tax will take priority over Capital Gains Tax and will apply to profits (or losses).</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto20250" title="CRYPTO20250 - Cryptoassets for individuals: what is trading">The Cryptoassets Manual</a></p>
<p>Most people's crypto activity falls under the Capital Gains Tax regime, but in certain circumstances – e.g. a high number of transactions, crypto being the main source of income, etc. – this activity could fall under the Income Tax regime (the regime applying to regular job salaries).</p>
<p>In my case though, crypto is definitely a hobby, so Capital Gains Tax applies.</p>
<h3 id="fiat-conversions">Fiat conversions</h3>
<p>Another side topic to address early on is the conversion from one <em>fiat</em> currency to another.</p>
<p>A fiat currency is a government-issued currency, such as the euro or the British pound. Not all my transactions are conducted in pounds, and as we'll see further down it is sometimes necessary to get price information from third-party websites denominating prices in a different currency.</p>
<p>HMRC issue <a href="https://www.gov.uk/government/collections/exchange-rates-for-customs-and-vat">monthly exchange rates</a> that they publish on their website, filed by year. These rates can be used to convert amounts to pounds.</p>
<h3 id="buying-and-selling">Buying and selling</h3>
<p>Under Capital Gains Tax, cryptocurrencies are referred to as <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22050"><em>assets</em></a> or <em>tokens</em>. When one buys an asset at a certain price and then sells this asset, if the obtained amount (the <em>proceeds</em>) is greater than the initial purchase price (the <em>cost basis</em>), then a <em>gain</em> has been <em>realised</em>.</p>
<p>The gain is the difference between the cost basis and the proceeds, and this amount is subject to Capital Gains Tax.</p>
<p>If, on the contrary, the proceeds are less than the cost basis, a <em>loss</em> has been realised and the difference can be deducted from gains acquired elsewhere.</p>
<p>Selling an asset is also referred to as a <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22100"><em>disposal</em></a> – a broader category of <em>taxable events</em> comprising:</p>
<ul>
<li>selling the asset for a <em>fiat</em> currency;</li>
<li>exchanging the asset for another asset;</li>
<li>using the asset to purchase goods and services; and</li>
<li>giving away the asset (unless to a spouse or civil partner).</li>
</ul>
<p>Let's unpack those.</p>
<h3 id="selling-an-asset-for-fiat-currency">Selling an asset for fiat currency</h3>
<p>Buying an asset with fiat currency and selling it for the same currency is the most straightforward scenario from an accounting perspective. Investors need to keep track of the cost basis of an asset acquisition and calculate whether a gain or loss is realised upon selling the asset.</p>
<p class="info"><span class="title">Example</span> Alice buys 5 ethers for £5000. She then sells 3 of these ethers for £4000. She initially bought these ethers at a <em>unit price</em> of <code>£5000 / 5 = £1000</code>, meaning the cost basis of the disposal is <code>£1000 * 3 = £3000</code>. Alice made a <code>£4000 - £3000 = £1000</code> gain, which is subject to Capital Gains Tax.</p>

<p>Some people buy and accumulate assets over time, sometimes through regular automated purchases (a strategy called <a href="https://www.investopedia.com/terms/d/dollarcostaveraging.asp"><em>dollar-cost averaging</em></a>). In that case, the way to calculate capital gains or losses differs based on when the asset is disposed of, following the rules of <a href="https://coinpanda.io/blog/crypto-taxes-uk-capital-gains/"><em>share pooling</em></a>.</p>
<p>The main idea of share pooling is that when an asset is acquired, it goes into a <em>pool</em>. That pool then grows or shrinks as more of the asset is acquired or disposed of. We calculate the cost basis of a disposal using the <em>average cost basis</em> of each purchase that flowed into the pool up to the date of the disposal.</p>
<p>This pool is also referred to as a <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22200"><em>Section 104 pool</em></a> or <em>Section 104 holding</em>.</p>
<p class="info"><span class="title">Example</span> Bob buys 2 ethers for £2000. A few days later, he buys 2 more ethers for £3000. He now has 4 ethers in the pool, for an average cost basis of <code>(£2000 + £3000) / 4 = £1250</code> per unit. A month later he decides to sell 3 ethers for £6000. He made a <code>£6000 - (3 * £1250) = £2250</code> gain, which is subject to Capital Gains Tax.</p>

<p>There is a couple of scenarios in which the Section 104 rule doesn't apply. The first one is called the <em>same-day</em> rule and covers cases where several operations involving the same asset happen on the same day.</p>
<p class="info"><span class="title">Calendar days</span> Note that we are referring to <em>calendar</em> days here, not 24-hour slots. For instance, if an asset was bought on Monday at 11 pm and then sold on Tuesday at 1 am, these are different days and the same-day rule does not apply.</p>

<p>One such scenario is when an asset is disposed of on the same day that it was acquired. When that happens, we use the cost basis of the purchases of that asset on that day, ignoring past acquisitions that may have flowed into a Section 104 pool.</p>
<p class="info"><span class="title">Example</span> On Monday, Charlie buys 1 ether for £1000, which goes into a new Section 104 pool. On Tuesday, he buys another ether for £1100. Later that day, he sells 1 ether for £1200. Since he sold 1 ether on the same day he bought one, the latter doesn't flow into the Section 104 pool and forms the cost basis of the sale – £1100. Charlie made a <code>£1200 - £1100 = £100</code> gain, which is subject to Capital Gains Tax.</p>

<p>What happens if the amount sold is greater than the other amounts purchased that day? In that case, we fall back to the Section 104 rule for the remainder of the amount.</p>
<p class="info"><span class="title">Example</span> On Monday, Alice buys 2 ethers for £2000. On Tuesday, she buys another ether for £1100. Later that day, she sells 2 ethers for £2400. Since she bought 1 ether on the same day, its cost basis forms the cost basis of the first ether sold – £1100. The cost basis of the second ether sold is the average cost basis of the Section 104 pool, so <code>£2000 / 2 = £1000</code> per unit. Alice made a <code>£2400 - (£1100 + £1000) = £300</code> gain, which is subject to Capital Gains Tax.</p>

<p>There is more. The same-day rule also applies if you buy back the asset on the same day, <em>after</em> you've sold it. The cost basis of the buy-back is then used to calculate the cost basis of the amount sold.</p>
<p class="info"><span class="title">Example</span> On Monday, Bob buys 3 ethers for £3000. On Tuesday, he sells 2 ethers for £2500. Later that day, he buys 1 ether for £1100. Since he bought back 1 ether on the same day he sold 2, the cost basis of the first ether sold is the cost basis of the ether he bought back. The cost basis of the second ether sold is the average cost basis of the Section 104 pool, so <code>£3000 / 3 = £1000</code> per unit. Bob made a <code>£2500 - (£1100 + £1000) = £400</code> gain, which is subject to Capital Gains Tax.</p>

<p>Finally, if you happen to purchase the same asset several times on the same day, at different prices, you need to use the average cost basis of the acquisitions to calculate the cost basis of all the disposals on that day, essentially treating all acquisitions and all disposals as single transactions:</p>
<blockquote>
<p>All shares of the same class in the same company acquired by the same person on the same day and in the same capacity are treated as though they were acquired by a single transaction, TCGA92/S105 (1)(a).</p>
<p>All shares of the same class in the same company disposed of by the same person on the same day and in the same capacity are also treated as though they were disposed of by a single transaction, TCGA92/S105 (1)(a).</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg51560#IDATX33F" title="CG51560 - Share identification rules for capital gains tax from 6.4.2008: the “same day” and “bed and breakfast” identification rules">The Capital Gains Manual</a></p>
<p>That's it for the same-day rule. So what's the second scenario in which the Section 104 rule doesn't apply? It's the <em>30-day</em> rule (also referred to as <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg13370" title="CG13370 - Bed and breakfasting: shares and securities"><em>bed and breakfasting</em></a>), which concerns assets being bought back within 30 days of being sold.</p>
<p>The rule works in the same way as the last same-day rule example above, by taking into account the cost basis of the buy-back for the calculation of the cost basis of the amount initially sold.</p>
<p class="info"><span class="title">Example</span> On Monday, Charlie buys 3 ethers for £3000. On Tuesday, he sells 2 ethers for £2500. Then, that Sunday, he buys back 1 ether for £900. Since he bought back 1 ether within 30 days of selling 2, the cost basis of the first ether sold is the cost basis of the ether he bought back. The cost basis of the second ether sold is the average cost basis of the Section 104 pool, so <code>£3000 / 3 = £1000</code> per unit. Charlie made a <code>£2500 - (£900 + £1000) = £600</code> gain, which is subject to Capital Gains Tax.</p>

<p>Note that because of this rule, you may want to wait for at least 30 days after the end of the tax year to compute your crypto gains and losses, in case transactions falling under the 30-day rule occur in that window.</p>
<p class="info"><span class="title">Why is it so complicated?</span> All these rules were implemented because of a practice called <a href="https://en.wikipedia.org/wiki/Wash_sale"><em>wash sale</em></a>. The idea is that an investor sells an asset at a loss to record that loss and thus reduces his tax liability, and then repurchases the asset shortly thereafter to maintain his exposure to it. The same-day and 30-day rules make this practice impossible.</p>

<h3 id="exchanging-an-asset-for-another-asset">Exchanging an asset for another asset</h3>
<p>Buying and selling from and to fiat is a common use case, but many investors also exchange (or <em>swap</em>) assets for other assets. These conversions also qualify as disposals (of the original asset) and are taxable events, even if no fiat currency is involved.</p>
<p>In that case, it's the investor's job to determine the cost basis of the operation, by finding out the <em>market value</em> of the sold asset in fiat terms at the time of the transaction. That market value should be taken from the exchange on which the swap was conducted if available, and from price-tracking websites such as <a href="https://coinmarketcap.com/">CoinMarketCap</a> or <a href="https://www.coingecko.com/">CoinGecko</a> if not.</p>
<p class="info"><span class="title">Example</span> Bob buys 2 ethers for £2000. A few days later, he swaps 1 ether for 0.1 bitcoins. He looks up the market value of the ETH token at the time of the swap and notes that it was £1500 per ether. As a result, Bob made a <code>£1500 - (£2000 / 2) = £500</code> gain with this transaction, which is subject to Capital Gains Tax. Bob eventually sells the 0.1 bitcoins for £2100. The cost basis of the acquired 0.1 bitcoins was £1500, so Bob made another gain of <code>£2100 - £1500 = £600</code>, which is also subject to Capital Gains Tax.</p>

<p>Note that <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22257">the rules of share pooling also apply here</a> – the only difference is that the cost basis in fiat terms must be established beforehand.</p>
<p class="info"><span class="title">What if the asset is not listed?</span> If the market value of one of the assets involved in the transaction isn't tracked anywhere, the market value of the other asset can be used instead. If none of the assets' market values is tracked, the investor must determine the <em>fair market value</em> of the disposed asset. It is not very clear how to do that, however.</p>

<h3 id="using-an-asset-to-purchase-goods-and-services">Using an asset to purchase goods and services</h3>
<p>I used cryptocurrency to purchase goods on a few occasions. This kind of operation is also a disposal and is equivalent to selling the corresponding asset for the price of the good in fiat terms.</p>
<p>When the good isn't priced in fiat at all, the investor is supposed to figure out its fair market value. Typically, that’d be the market value of the asset sold for the good at the time of the transaction, as reported by a price-tracking platform like mentioned earlier.</p>
<p class="info"><span class="title">Example</span> Charlie buys 0.5 bitcoins for £10000, at a unit price of £20000 per bitcoin. He wants to attend an event whose tickets are exclusively priced in bitcoin, at 0.1 bitcoins each. Charlie looks up the market value of the BTC token at the time of the purchase and notes that it was £21000 per bitcoin. As a result, Charlie made a <code>(£21000 * 0.1) - (£20000 * 0.1) = £100</code> gain with this transaction, which is subject to Capital Gains Tax.</p>

<p>Keep in mind that here too, share pooling rules apply.</p>
<h3 id="fees-in-fiat">Fees in fiat</h3>
<p>Most exchanges charge a fee for the following operations:</p>
<ul>
<li>purchasing an asset with fiat currency;</li>
<li>selling an asset for fiat currency; and</li>
<li>swapping an asset for another.</li>
</ul>
<p>This type of fee is part of the <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22150"><em>allowable expenses</em></a> or <em>allowable costs</em>, and it can be deducted.</p>
<p>When buying an asset with fiat currency, the fee must be <em>included</em> in the cost basis:</p>
<p class="info"><span class="title">Example</span> Alice buys 2 ethers for £2000 on an exchange. The exchange charges a £20 fee to execute the transaction. The cost basis of the 2 ethers is then <code>£2000 + £20 = £2020</code>, so a unit price of £1010.</p>

<p>When selling an asset for fiat currency, the fee must be <em>excluded</em> from the proceeds:</p>
<p class="info"><span class="title">Example</span> A couple of months later, Alice sells one of her ethers for £2500 on the same exchange. The exchange charges a £25 fee to execute the transaction. Alice made a <code>(£2500 - £25) - (£1010 * 1) = £1465</code> gain, which is subject to Capital Gains Tax.</p>

<p>Finally, when swapping an asset for another, the fee can either be <em>excluded</em> from the proceeds of the disposed asset or <em>included</em> in the cost basis of the acquired asset:</p>
<blockquote>
<p>Exchange (swap) token A for token B: the fee paid is in relation to the whole of the transaction, that is for a disposal of one asset and the acquisition of another asset. This means that the fee is attributable to both assets. HMRC’s view is that this fee would be allowable as a deduction in computing the disposal in respect of token A under section 38(1)(c), and that it would be allowable as a deduction in computing the eventual disposal of token B under section 38(1)(a). TCGA92/S52(1) makes it clear that a sum may be allowed as a deduction only once in computing a disposal.</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22150" title="CRYPTO22150 - Cryptoassets for individuals: Capital Gains Tax: allowable expenses">The Cryptoassets Manual</a></p>
<p>But there is also a third way:</p>
<blockquote>
<p>Where an allowable cost relates to more than one asset, the cost should be apportioned between those assets on a just and reasonable basis (TCGA92/S52(4)). You can accept that apportioning this type of fee equally between the assets disposed of and the assets acquired (that is a 50/50 split) is just and reasonable in these circumstances.</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22150" title="CRYPTO22150 - Cryptoassets for individuals: Capital Gains Tax: allowable expenses">The Cryptoassets Manual</a></p>
<p>This means that the fee can also be split in half – 50% is excluded from the proceeds of the disposed asset and the other 50% is included in the cost basis of the acquired asset. This is the method I'll be using from now on.</p>
<p class="info"><span class="title">Example</span> Alice swaps her remaining ether for 0.1 bitcoins on the same exchange. The exchange charges a £10 fee to execute the transaction. Alice looks up the market value of the ETH token at the time of the transaction and notes that it was £3000 per ether. As 50% of the fee must be excluded from the market value of the disposed ether, Alice made a <code>£3000 - (£10 / 2) - £1010 = £1985</code> gain with this transaction, which is subject to Capital Gains Tax. As 50% of the fee must be included in the cost basis of the acquired bitcoins, the corresponding amount is <code>£3000 + (£10 / 2) = £3005</code>.</p>

<p>Things are slowly getting complicated, but the real fun starts when transaction fees are settled in cryptocurrency.</p>
<h3 id="fees-in-cryptocurrency">Fees in cryptocurrency</h3>
<p>The HMRC Cryptoassets Manual has a page dedicated to <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22280"><em>fees satisfied in tokens</em></a>. These fees can be issued by exchanges (e.g. when swapping an asset for another) or be associated with the operating costs of the underlying network (e.g. the blockchain). The latter include transferring an asset from one wallet to another, for instance.</p>
<p>Fees settled in cryptocurrency are treated differently because they are both an allowable cost and a disposal:</p>
<blockquote>
<p>Most cryptoasset transactions require the person disposing of the tokens to pay a fee. This fee will often be satisfied in tokens. If the transaction fee is satisfied in tokens then you need to consider that fee as one of the costs for the disposal of the tokens, but you also need to consider the fee as a disposal in its own right.</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22280" title="CRYPTO22280 - Cryptoassets for individuals: Capital Gains Tax: Fees satisfied in tokens">The Cryptoassets Manual</a></p>
<p>This means that in a swapping transaction whose fee is settled in cryptocurrency, and when following the fee-split rule, not only 50% of the market value of the fee must be excluded from the proceeds of the disposed asset and the other 50% included in the cost basis of the acquired asset, but the entire market value of the fee must also be counted as a disposal, <em>following the share pooling rules</em>. Read that again.</p>
<div class="info"><p><span class="title">Example</span> Bob buys 0.2 bitcoins for £4000 on an exchange, at a unit price of £20000 per bitcoin. A few weeks later he swaps 0.1 bitcoins for 2 ethers. The exchange charges a 0.001 BTC fee for the transaction. Bob looks up the market value of the BTC token at the time of the transaction and notes that it was £30000 per bitcoin.</p><p>As 50% of the market value of the fee must be excluded from the market value of the disposed bitcoins, Bob made a <code>(£30000 * 0.1) - (£30000 * 0.001 / 2) - (£20000 * 0.1) = £985</code> gain with this transaction, which is subject to Capital Gains Tax.</p><p>As 50% of the market value of the fee must be included in the cost basis of the acquired ethers, the corresponding amount is <code>(£30000 * 0.1) + (£30000 * 0.001 / 2) = £3015</code>.</p><p>As the fee also constitutes a disposal, Bob made another <code>(£30000 * 0.001) - (£20000 * 0.001) = £10</code> gain with this transaction, which is subject to Capital Gains Tax. But as both disposals happened on the same day, they must be treated as a single transaction.</p><p>In the end, Bob made a <code>(£30000 * (0.1 + 0.001)) - (£30000 * 0.001 / 2) - (£20000 * (0.1 + 0.001)) = £995</code> gain with this transaction, which is subject to Capital Gains Tax.</p></div>

<p>How about transferring an asset from one wallet to another? As long as you are the owner of both wallets, there is no capital gain to report on the transferred amount:</p>
<blockquote>
<p>There is no disposal if the individual retains beneficial ownership of the tokens throughout the transaction, for example moving tokens between public addresses that the individual beneficially controls (commonly described as moving tokens between wallets).</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22100" title="CRYPTO22100 - Cryptoassets for individuals: Capital Gains Tax: what is a disposal">The Cryptoassets Manual</a></p>
<p>The transaction fee, however, constitutes an asset disposal subject to Capital Gains Tax. It is also an allowable cost, although it is not attributable to an asset. The investor should keep track of all these non-attributable transaction fees and deduct them from the capital gains when completing his tax return.</p>
<p class="info"><span class="title">Example</span> Charlie buys 1 ether for £1000 on an exchange. A few months later he acquires a hardware wallet and decides to move his ether to it. The transaction incurs a fee of 0.01 ethers. Charlie looks up the market value of the ETH token at the time of the transaction and notes that it was £2000 per ether. Charlie made a <code>(£2000 * 0.01) - (£1000 * 0.01) = £10</code> gain, which is subject to Capital Gains Tax. The transaction fee is also an allowable cost of <code>£2000 * 0.01 = £20</code>, deductible from capital gains.</p>

<h3 id="decentralised-finance">Decentralised Finance</h3>
<p><em>Decentralised finance</em> or <em>DeFi</em> aims at offering a range of financial services built on top of blockchain technology, without centralised intermediaries. DeFi protocols are extremely varied and the returns they generate can either be considered as income or capital gains based on various criteria:</p>
<blockquote>
<p>How the return is taxed upon receipt by the lender/liquidity provider will depend on whether the return has the nature of capital or revenue. The nature of the return received by the lender/liquidity provider will depend on how the transaction is structured.</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto61214" title="CRYPTO61214 - Decentralised Finance: Lending and staking: Income tax: Making a DeFi loan: Nature of the return">The Cryptoassets Manual</a></p>
<p>I have only dabbed a little in DeFi and thankfully the protocol I’ve been using seems to fall under the "return has the nature of capital" category, which will make the corresponding tax calculations similar to that of regular crypto-to-crypto transactions.</p>
<div class="info"><p><span class="title">Example</span> Alice lends 3 ethers previously acquired for £6000 to a DeFi protocol that doesn't guarantee a specific return. She gets 3 zETH in exchange, a token that represents her lending. Alice looks up the market value of the ETH token at the time of the transaction and notes that it was £3000 per ether. Alice made a <code>(£3000 * 3) - £6000 = £3000</code> gain, which is subject to Capital Gains Tax. The cost basis of the 3 zETH tokens is <code>£3000 * 3 = £9000</code>.</p><p>A few months later she decides to withdraw her ethers from the DeFi protocol. She returns the 3 zETH and gets back 3.1 ethers. There is no price-tracking information for the zETH token, so Alice looks up the market value of the ETH token at the time of the transaction and notes that it was £3200 per ether. Alice made a <code>(£3200 * 3.1) - £9000 = £920</code> gain, which is subject to Capital Gains Tax.</p></div>

<h3 id="non-fungible-tokens">Non-Fungible Tokens</h3>
<p><em>Non-Fungible Tokens</em> or <em>NFTs</em> are also subject to Capital Gains Tax. But the key difference with <em>fungible tokens</em> (e.g. bitcoins or ethers) is that, because of their uniqueness, share pooling rules don't apply to NFTs:</p>
<blockquote>
<p>Non-Fungible Tokens (NFTs) are separately identifiable and so are not pooled.</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22200" title="CRYPTO22200 - Cryptoassets for individuals: Capital Gains Tax: pooling">The Cryptoassets Manual</a></p>
<p class="info"><span class="title">Example</span> Bob buys an NFT on a platform for £500. Later that day, he sells it for £600, making a £100 gain which is subject to Capital Gains Tax. A week later, he buys the same NFT again for £400. Because share pooling rules don't apply, the cost basis of the sold NFT is still £500. Bob made a <code>£600 - £500 = £100</code> gain, which is subject to Capital Gains Tax.</p>

<p>Where it gets tricky in my case is that I <em>minted</em> (created) some NFTs in exotic ways, for instance by <em>burning</em> several NFTs to create a new one. In that case, the cost basis of the new NFT is the sum of the cost bases of the burnt NFTs.</p>
<p class="info"><span class="title">Example</span> Charlie buys an NFT depicting a lion for £500. He then successively buys an NFT of a goat for £300 and an NFT of a snake for £400. He burns the three NFTs to mint a new NFT, depicting the Chimera. A few days later, he sells the Chimera NFT for £2000. Charlie made a <code>£2000 - (£500 + £300 + £400) = £800</code> gain, which is subject to Capital Gains Tax.</p>

<h3 id="airdrops">Airdrops</h3>
<p><a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22350"><em>Airdrops</em></a> are a way for developers to distribute an asset and kickstart a community. The corresponding tokens can either be sent to wallet addresses directly or <em>claimed</em> by investors:</p>
<blockquote>
<p>An airdrop is when an individual receives an allocation of tokens. For example, tokens that are given as part of a marketing or advertising campaign.</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22350" title="CRYPTO22350 - Cryptoassets for individuals: Capital Gains Tax: airdrops">The Cryptoassets Manual</a></p>
<p>Airdropped tokens also follow the rules of share pooling – they go to a new Section 104 pool if the investor didn't <em>hold</em> any yet or flow into the existing pool if she did. Their cost basis is the market value of the asset at the time it was airdropped.</p>
<div class="info"><p><span class="title">Example</span> Alice receives 100 MEOW tokens as part of a marketing campaign. She did not previously hold this asset so the tokens go to a new Section 104 pool. Alice looks up the market value of the MEOW token at the time of the transaction and notes that it was £1 per MEOW.</p><p>A few days later, Alice buys another 100 MEOW tokens for £200 on an exchange, which flow into the existing Section 104 pool. The average cost basis of the pool is <code>(£100 + £200) / (100 + 100) = £1.5</code> per unit. A month later, Alice sells 150 MEOW tokens for £300. Alice made a <code>£300 - (150 * £1.5) = £75</code> gain, which is subject to Capital Gains Tax.</p></div>

<p>But airdropped tokens are a bit special – they can also be considered as income when recipients qualified for the airdrop based on past activity:</p>
<blockquote>
<p>Income Tax will not always apply to airdropped tokens received in a personal capacity. Income Tax may not apply if they’re received:</p>
<ul>
<li>without doing anything in return (for example, not related to any service or other conditions)  </li>
<li>not as part of a trade or business involving cryptoasset exchange tokens or mining</li>
</ul>
<p>Airdrops that are provided in return for, or in expectation of, a service are subject to Income Tax either as:</p>
<ul>
<li>miscellaneous income  </li>
<li>receipts of an existing trade</li>
</ul>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto21250" title="CRYPTO21250 - Cryptoassets for individuals: Income Tax: airdrops">The Cryptoassets Manual</a></p>
<p class="info"><span class="title">Example</span> The reason Alice received the 100 MEOW tokens in the first place is that she opened a Cat wallet a few months prior to the airdrop. Since the price of the MEOW token at the time of the transaction was £1 per MEOW, Alice received <code>100 * £1 = £100</code> as income, which is subject to Income Tax.</p>

<p>This is something to keep in mind when you qualify for an airdrop – if the airdrop is not directly sent to your wallet and you have to claim it instead, it could be worth waiting for a token price drop before claiming.</p>
<h3 id="hard-forks">Hard forks</h3>
<p><em>Forks</em> occur when updates are made to the protocol underlying the blockchain. There are two types of forks – <em>soft</em> forks and <em>hard</em> forks. Soft forks happen when the changes are backward-compatible (like a patch or minor version release in <a href="https://semver.org">Semantic Versioning</a>), while hard forks occur when the new version of the protocol isn't compatible with the old one (like a major version release with breaking changes).</p>
<p>In the latter case, when there is still significant support for the old version of the protocol, the old blockchain and the new blockchain begin a life of their own, independent from each other. That often leads to the creation of two separate assets:</p>
<blockquote>
<p>There are two types of forks, a soft fork and a hard fork. A soft fork updates the protocol and is intended to be adopted by all. No new tokens, or distributed ledger, are expected to be created. A hard fork is different and can result in new tokens coming into existence. Before the fork occurs there is a single distributed ledger. Usually, at the point of the hard fork a second branch (and therefore a new cryptoasset) is created.</p>
</blockquote>
<p>– <a href="https://www.gov.uk/hmrc-internal-manuals/cryptoassets-manual/crypto22300" title="CRYPTO22300 - Cryptoassets for individuals: Capital Gains Tax: blockchain forks">The Cryptoassets Manual</a></p>
<p>Holders of the original asset usually receive the newly created asset at a 1:1 ratio, using a snapshot of the original blockchain as reference.</p>
<p>For tax-treatment purposes, the new asset goes to its own Section 104 pool and its cost basis is derived from the original asset (which is different from airdrops, where we assign the market value of the asset at the time it was airdropped). This means that the average cost basis of the original asset can be split between the two assets.</p>
<p>It is also allowed to maintain the average cost basis of the original asset as it is, and to assign a zero cost basis to the new asset instead, which is simpler:</p>
<p class="info"><span class="title">Example</span> Bob was holding 5 bitcoins (BTC) when the Bitcoin Cash fork occurred in 2017.  As a result, he received 5 BCH. Bob later sold his 5 BCH for £1000. As the cost basis for the acquisition of the 5 BCH was 0, Bob made a £1000 gain, which is subject to Capital Gains Tax.</p>

<h3 id="gifts">Gifts</h3>
<p>Finally, when receiving an asset as a gift from someone who is not your spouse or civil partner, you need to work out the price of the asset in fiat terms at the time of the transaction and use it as the cost basis of the asset when you dispose of it.</p>
<p class="info"><span class="title">Example</span> Charlie receives 0.1 bitcoins from his sister. He later sells them for £2200. Charlie looks up the market value of the BTC token at the time of the gift and notes that it was £20000 per bitcoin. As a result, Charlie made a <code>£2200 - (£20000 * 0.1) = £200</code> gain, which is subject to Capital Gains Tax.</p>

<p>The gift in and of itself is not a taxable event for the person receiving it, but is subject to Capital Gains Tax for the person making it, following the same rules as any other disposal.</p>
<p>Even though I am not concerned by this scenario at the time of writing, it is also worth looking into gifts coming from a spouse or civil partner, as I couldn't find this information in the HMRC Cryptoassets Manual and it was brought up during a conversation with a specialised accountant instead.</p>
<p>When an asset is gifted to a spouse or civil partner, the transaction is not considered a taxable event for either of the parties, and the cost basis of the disposal is the cost basis of the initial acquisition by the person making the gift.</p>
<p class="info"><span class="title">Example</span> Alice gifts 2 ethers previously acquired for £2000 to her spouse. Alice looks up the price of the ETH token at the time of the gift and notes that it was £1500 per ether. But since she gifted the ethers to her spouse, the transaction doesn’t constitute a taxable event. A few months later, Alice's spouse sells the 2 ethers for £4000. But since he got these ethers from his spouse in the first place, their cost basis is not the market value at the time of the gift, but at the time Alice first acquired the ethers. Alice's spouse made a <code>£4000 - £2000 = £2000</code> gain, which is subject to Capital Gains Tax.</p>

<h2 id="closing-thoughts">Closing thoughts</h2>
<p>Coming up with the domain can be a bit messy. Even though I was able to narrow it down from the get-go by focussing on my specific use cases, that is still a lot of information – a good chunk of which will turn out to be noise.</p>
<p>Some of the rules and examples laid out in this article are rather complicated and some of it may have gone over your head. That's OK. Then again, this series is not so much about crypto taxes as it is about building an application following a DDD approach. The main goal of this post was to give you an idea of what a domain is and how to express it.</p>
<p>While I've tried to emphasise the terms which I think are good candidates for the ubiquitous language, at this stage I don't know for sure which bits will make it to the model. That will be the focus of the <a href="/posts/a-crypto-activity-tracking-tool-part-2-the-model" title="Building a PHP CLI tool using DDD and Event Sourcing. Part 2: the model">next part</a> of the series.</p>
<p>Subscribe to email alerts below so you don't miss it, or follow me on <a href="https://twitter.com/osteel">Twitter</a> where I will share the next posts as soon as they are published.</p>

    <div class="sharethis-inline-share-buttons"></div>

    <section class="info">
      <span class="title">Enjoying the content?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p class="meta">
      <small>
        Last updated by osteel on
          <time datetime="2022-12-04" pubdate>2022-12-04</time>
          :: [
          <a href="https://tech.osteel.me/tag/ddd">ddd</a>
          ]
      </small>
    </p>

    <section>
      <h2>Comments</h2>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
    </section>
  </div>
</div>
      </div>

      <label for="sidebar-checkbox" class="sidebar-toggle"></label>

      <script>
        (function(document) {
          var i = 0;
          // snip empty header rows since markdown can't
          var rows = document.querySelectorAll('tr');
          for(i=0; i<rows.length; i++) {
            var ths = rows[i].querySelectorAll('th');
            var rowlen = rows[i].children.length;
            if (ths.length > 0 && ths.length === rowlen) {
              rows[i].remove();
            }
          }
        })(document);
      </script>

      <script>
        /* Lanyon & Poole are Copyright (c) 2014 Mark Otto. Adapted to Pelican 20141223 and extended a bit by @thomaswilley */
        (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');
          document.addEventListener('click', function(e) {
            var target = e.target;
            if(!checkbox.checked ||
            sidebar.contains(target) ||
            (target === checkbox || target === toggle)) return;
            checkbox.checked = false;
            }, false);
            })(document);
      </script>

      <script type="text/javascript">
        var disqus_shortname = "osteel";
              var disqus_identifier = "/posts/a-crypto-activity-tracking-tool-part-1-the-domain";
              var disqus_url = "https://tech.osteel.me/posts/a-crypto-activity-tracking-tool-part-1-the-domain";
              var disqus_title = "Building a PHP CLI tool using DDD and Event Sourcing. Part 1: the domain";
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
      </script>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53994673-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53994673-2');
    ga('send', 'pageview');
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1B7BNCQ79N"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1B7BNCQ79N');
</script>

     </div>
  </body>
</html>