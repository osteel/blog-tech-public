<!DOCTYPE html>
<html lang="en">
  <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
    <link rel="shortcut icon" type="image/x-icon" href="https://tech.osteel.me/favicon.ico" />

    <meta name="author" content="Yannick Chenot"/>
    <meta property="og:image" content="https://tech.osteel.me/images/2023/03/15/rector.png" />

    <meta name="google-site-verification" content="KhtQOQ0ZVgZ55KSEoXMOWo_seu_e_JbV6xBk_SuewYI" />

    <meta name="monetization" content="$ilp.uphold.com/miU94ZyFdQ6K">

    <title>Upgrade your project to PHP 8.2 with Rector &mdash; osteel's blog</title>

    <meta charset="utf-8" />
    <link href="https://tech.osteel.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Full Atom Feed" />
    <link href="https://tech.osteel.me/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog Full RSS Feed" />
    <link href="https://tech.osteel.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Atom Feed" />
    <link href="https://tech.osteel.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog RSS Feed" />
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/poole.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/syntax.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/lanyon.css"/>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/styles.css"/>

    <script
      type="text/javascript"
      src="https://platform-api.sharethis.com/js/sharethis.js#property=5e6053b434311400122fd1f8&product=inline-share-buttons"
      async="async">
    </script>



  <meta name="description" content="I wanted to upgrade a project to PHP 8.2 and figured I could use Rector for this. Not only was I right, but I had also completely underestimated how easy it was going to be." />
  <meta name="twitter:description" content="I wanted to upgrade a project to PHP 8.2 and figured I could use Rector for this. Not only was I right, but I had also completely underestimated how easy it was going to be.">

  <meta name="tags" content="rector" />
  <meta name="tags" content="refactoring" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@osteel">
  <meta name="twitter:creator" content="@osteel">
  <meta name="twitter:title" content="Upgrade your project to PHP 8.2 with Rector">
  <meta name="twitter:image" content="https://tech.osteel.me/images/2023/03/15/rector.png">

  </head>

  <body>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="profile">
      <img src="https://www.gravatar.com/avatar/158eb527bb4ceb8e1a84e74b39815b71"/>
    </div>
  </div>

  <section>
    <p>Demat ! I'm Yannick, a senior backend developer based in Brighton, UK.</p>
  </section>

  <section>
    <ul class="sidebar-nav">
    </ul>
  </section>

  <section>
    <h2>Newsletter</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
      <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="Email address" required>
      <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
      <input type="submit" hidden />
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
    </form>
  </section>

  <section>
    <h2>Categories</h2>
    <nav class="sidebar-nav">
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/blogging">Blogging</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/business">Business</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/devops">DevOps</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/laravel">Laravel</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/misc">Misc</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/news">News</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/php">PHP</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/productivity">Productivity</a>

    </nav>
  </section>

  <section>
    <h2>Search</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://tech.osteel.me/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
        <input class="form-input" type="text" name="q" placeholder="Search" />
    </form>
  </section>

    <section>
        <h2>Find me</h2>
        <ul class="sidebar-nav">
            <li><a class="sidebar-nav-item" href="https://github.com/osteel" target="_blank">GitHub</a></li>
            <li><a class="sidebar-nav-item" href="https://twitter.com/osteel" target="_blank">Twitter</a></li>
            <li><a class="sidebar-nav-item" href="https://www.linkedin.com/in/yannickchenot" target="_blank">LinkedIn</a></li>
        </ul>
    </section>

  <section>
    <h2>Feeds</h2>
    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">All posts&nbsp;
        [&nbsp;
 <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a>        &nbsp;
 <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a>        &nbsp;]
      </li>
    </ul>
  </section>

  <div class="sidebar-item">
    <p>
    <a href="https://twitter.com/osteel">&copy; @osteel</a> 2023
    </p>
    <p class="tiny-note">
      Powered by <a href="http://getpelican.com">Pelican</a> :: Theme based on <a class="muted" href="https://github.com/thomaswilley/pelicanyan">Pelicanyan</a>
    </p>
  </div>
</div>    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://tech.osteel.me/" title="Home">osteel's blog</a>
            <small>Web development resources</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="posts">
<div class="post">
    <h1 class="post-title">
      Upgrade your project to PHP 8.2 with Rector
    </h1>
    <span class="post-date">
      <small>
          Last updated: 2023-03-15 ::
        Published: 2023-03-15
          :: [ <a href="https://github.com/osteel/blog-tech-public/commits/master/posts/upgrade-your-project-to-the-latest-php-version-with-rector.html">history</a> ]
      </small>
    </span>

    <section class="info">
      <span class="title">Been here before?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p><img alt="Upgrade your project to the latest PHP version with Rector" src="/images/2023/03/15/rector.png" title="Upgrade your project to the latest PHP version with Rector" /></p>
<p>I wanted to upgrade a project to PHP 8.2 and figured I could use <a href="https://getrector.com/">Rector</a> for this.</p>
<p>Not only was I right, but I had also completely underestimated how easy it was going to be.</p>
<h2 id="what-is-rector">What is Rector?</h2>
<p><a href="https://getrector.com/">Rector</a> is a tool written in PHP allowing you to automate various refactoring tasks. It analyses your code and applies whatever <a href="https://github.com/rectorphp/rector/blob/main/docs/rector_rules_overview.md" title="Rules Overview">rules</a> you've specified in its <a href="https://getrector.com/documentation" title="Documentation">configuration</a>.</p>
<p>It is also possible to <a href="https://getrector.com/documentation/custom-rule" title="Custom Rule">create your own rules</a>.</p>
<h2 id="upgrade-your-project-to-php-82">Upgrade your project to PHP 8.2</h2>
<p>You first need to install Rector as a development dependency:</p>
<div class="highlight"><pre><span></span>$ composer require --dev rector/rector
</pre></div>


<p>Then, generate the <code>rector.php</code> configuration file at the root of your project:</p>
<div class="highlight"><pre><span></span>$ ./vendor/bin/rector init
</pre></div>


<p>Open that file and replace its content with the following:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">use</span> <span class="nx">Rector\Config\RectorConfig</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Rector\Set\ValueObject\LevelSetList</span><span class="p">;</span>

<span class="k">return</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nx">RectorConfig</span> <span class="nv">$rectorConfig</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
    <span class="nv">$rectorConfig</span><span class="o">-&gt;</span><span class="na">sets</span><span class="p">([</span><span class="nx">LevelSetList</span><span class="o">::</span><span class="na">UP_TO_PHP_82</span><span class="p">]);</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<p>Perform a dry run to check what changes Rector is about to make (the below analyses the <code>app</code> folder as an example):</p>
<div class="highlight"><pre><span></span>$ ./vendor/bin/rector process app --dry-run
</pre></div>


<p>Apply the changes if you're happy with them:</p>
<div class="highlight"><pre><span></span>$ ./vendor/bin/rector process app
</pre></div>


<p>You can also specify the paths to analyse in the configuration file:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">use</span> <span class="nx">Rector\Config\RectorConfig</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Rector\Set\ValueObject\LevelSetList</span><span class="p">;</span>

<span class="k">return</span> <span class="k">static</span> <span class="k">function</span> <span class="p">(</span><span class="nx">RectorConfig</span> <span class="nv">$rectorConfig</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
    <span class="nv">$rectorConfig</span><span class="o">-&gt;</span><span class="na">paths</span><span class="p">([</span>
        <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/app&#39;</span><span class="p">,</span>
        <span class="c1">// ...</span>
    <span class="p">]);</span>

    <span class="nv">$rectorConfig</span><span class="o">-&gt;</span><span class="na">sets</span><span class="p">([</span><span class="nx">LevelSetList</span><span class="o">::</span><span class="na">UP_TO_PHP_82</span><span class="p">]);</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<p>After which you can simply run:</p>
<div class="highlight"><pre><span></span>$ ./vendor/bin/rector process
</pre></div>


<h2 id="what-just-happened">What just happened?</h2>
<p>In the above, the <code>UP_TO_PHP_82</code> constant means that not only the rules to upgrade from PHP 8.1 to PHP 8.2 were applied, but so did those from PHP 8.0 to PHP 8.1, as well as all the other ones down to PHP 5.2.</p>
<p>That's right – you can bring an entire code base from PHP 5.2 to the latest version with a single command, using predefined rulesets provided by Rector.</p>
<p>But there's more – check all the available rules and their description <a href="https://github.com/rectorphp/rector/blob/main/docs/rector_rules_overview.md" title="Rules Overview">here</a>, which go way beyond version-related changes. And, as mentioned earlier, you can also <a href="https://getrector.com/documentation/custom-rule" title="Custom Rule">create your own rules</a> if need be.</p>
<h2 id="closing-thoughts">Closing thoughts</h2>
<p>Rector has been on my radar for a while and I even used it a few times before, yet I'm still surprised by how powerful it is.</p>
<p>While it seems to be getting a little more traction recently, along with other static analysis tools like <a href="https://phpstan.org/">PHPStan</a>, it is still very much underused. One of the reasons is probably that developers are unaware of its potential, of which the above is a mere preview.</p>
<p>There is a <a href="https://getrector.com/book" title="Rector - The Power of Automated Refactoring">book</a> covering Rector in depth, which I'm planning to read soon.</p>

    <div class="sharethis-inline-share-buttons"></div>

    <section class="info">
      <span class="title">Enjoying the content?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p class="meta">
      <small>
        Last updated by osteel on
          <time datetime="2023-03-15" pubdate>2023-03-15</time>
          :: [
          <a href="https://tech.osteel.me/tag/rector">rector</a>
          <a href="https://tech.osteel.me/tag/refactoring">refactoring</a>
          ]
      </small>
    </p>

    <section>
      <h2>Comments</h2>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
    </section>
  </div>
</div>
      </div>

      <label for="sidebar-checkbox" class="sidebar-toggle"></label>

      <script>
        (function(document) {
          var i = 0;
          // snip empty header rows since markdown can't
          var rows = document.querySelectorAll('tr');
          for(i=0; i<rows.length; i++) {
            var ths = rows[i].querySelectorAll('th');
            var rowlen = rows[i].children.length;
            if (ths.length > 0 && ths.length === rowlen) {
              rows[i].remove();
            }
          }
        })(document);
      </script>

      <script>
        /* Lanyon & Poole are Copyright (c) 2014 Mark Otto. Adapted to Pelican 20141223 and extended a bit by @thomaswilley */
        (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');
          document.addEventListener('click', function(e) {
            var target = e.target;
            if(!checkbox.checked ||
            sidebar.contains(target) ||
            (target === checkbox || target === toggle)) return;
            checkbox.checked = false;
            }, false);
            })(document);
      </script>

      <script type="text/javascript">
        var disqus_shortname = "osteel";
              var disqus_identifier = "/posts/upgrade-your-project-to-the-latest-php-version-with-rector";
              var disqus_url = "https://tech.osteel.me/posts/upgrade-your-project-to-the-latest-php-version-with-rector";
              var disqus_title = "Upgrade your project to PHP 8.2 with Rector";
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
      </script>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53994673-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53994673-2');
    ga('send', 'pageview');
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1B7BNCQ79N"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1B7BNCQ79N');
</script>

     </div>
  </body>
</html>