<!DOCTYPE html>
<html lang="en">
  <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
    <link rel="shortcut icon" type="image/x-icon" href="https://tech.osteel.me/favicon.ico" />

    <meta name="author" content="Yannick Chenot"/>
    <meta property="og:image" content="https://tech.osteel.me/images/2015/02/24/pelican-main.png" />

    <meta name="google-site-verification" content="KhtQOQ0ZVgZ55KSEoXMOWo_seu_e_JbV6xBk_SuewYI" />

    <meta name="monetization" content="$ilp.uphold.com/miU94ZyFdQ6K">

    <title>Install and deploy a Pelican blog using Fabric - Part 3: Fabric &mdash; osteel's blog</title>

    <meta charset="utf-8" />
    <link href="https://tech.osteel.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Full Atom Feed" />
    <link href="https://tech.osteel.me/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog Full RSS Feed" />
    <link href="https://tech.osteel.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Atom Feed" />
    <link href="https://tech.osteel.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog RSS Feed" />
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/poole.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/syntax.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/lanyon.css"/>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/styles.css"/>

    <script
      type="text/javascript"
      src="https://platform-api.sharethis.com/js/sharethis.js#property=5e6053b434311400122fd1f8&product=inline-share-buttons"
      async="async">
    </script>



  <meta name="description" content="In part 2, we covered the installation and configuration of Pelican in our local environment. It is now time to provision our server and publish content using Fabric." />
  <meta name="twitter:description" content="In part 2, we covered the installation and configuration of Pelican in our local environment. It is now time to provision our server and publish content using Fabric.">

  <meta name="tags" content="vagrant" />
  <meta name="tags" content="fabric" />
  <meta name="tags" content="tutorial" />
  <meta name="tags" content="python" />
  <meta name="tags" content="blog" />
  <meta name="tags" content="pelican" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@osteel">
  <meta name="twitter:creator" content="@osteel">
  <meta name="twitter:title" content="Install and deploy a Pelican blog using Fabric - Part 3: Fabric">
  <meta name="twitter:image" content="https://tech.osteel.me/images/2015/02/24/pelican-main.png">

  </head>

  <body>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="profile">
      <img src="https://www.gravatar.com/avatar/158eb527bb4ceb8e1a84e74b39815b71"/>
    </div>
  </div>

  <section>
    <p>Demat ! I'm Yannick, a senior backend developer based in Brighton, UK.</p>
  </section>

  <section>
    <ul class="sidebar-nav">
        <li><a class="sidebar-nav-item" href="https://tech.osteel.me/pages/about">About</a></li>
    </ul>
  </section>

  <section>
    <h2>Search</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://tech.osteel.me/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
        <input class="form-input" type="text" name="q" placeholder="Search" />
    </form>
  </section>

  <section>
    <h2>Categories</h2>
    <nav class="sidebar-nav">
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/blogging">Blogging</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/business">Business</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/devops">DevOps</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/laravel">Laravel</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/misc">Misc</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/php">PHP</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/productivity">Productivity</a>

    </nav>
  </section>

    <section>
        <h2>Find me</h2>
        <ul class="sidebar-nav">
            <li><a class="sidebar-nav-item" href="https://github.com/osteel" target="_blank">GitHub</a></li>
            <li><a class="sidebar-nav-item" href="https://twitter.com/osteel" target="_blank">Twitter</a></li>
            <li><a class="sidebar-nav-item" href="https://www.linkedin.com/in/yannickchenot" target="_blank">LinkedIn</a></li>
            <li><a class="sidebar-nav-item" href="https://instagram.com/osteel" target="_blank">Instagram</a></li>
        </ul>
    </section>

  <section>
    <h2>Feeds</h2>
    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">All posts&nbsp;
        [&nbsp;
 <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a>        &nbsp;
 <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a>        &nbsp;]
      </li>
    </ul>
  </section>

  <div class="sidebar-item">
    <p>
    <a href="https://twitter.com/osteel">&copy; @osteel</a> 2022
    </p>
    <p class="tiny-note">
      Powered by <a href="http://getpelican.com">Pelican</a> :: Theme based on <a class="muted" href="https://github.com/thomaswilley/pelicanyan">Pelicanyan</a>
    </p>
  </div>
</div>    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://tech.osteel.me/" title="Home">osteel's blog</a>
            <small>Web development resources</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="posts">
<div class="post">
    <h1 class="post-title">
      Install and deploy a Pelican blog using Fabric - Part 3: Fabric
    </h1>
    <span class="post-date">
      <small>
          Last updated: 2015-03-04 ::
        Published: 2015-03-02
          :: [ <a href="https://github.com/osteel/blog-tech-public/commits/master/posts/install-and-deploy-a-pelican-blog-using-fabric-part-3-fabric.html">history</a> ]
      </small>
    </span>

    <section class="info">
      <span class="title">Been here before?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p>In <a href="/posts/2015/02/26/install-and-deploy-a-pelican-blog-using-fabric-part-2-installation-and-configuration.html" title="Install and deploy a Pelican blog using Fabric - Part 2: installation and configuration">part 2</a>, we covered the installation and configuration of Pelican in our local environment. It is now time to provision our server and publish content using Fabric.</p>
<p>But first, let's version our blog.</p>
<h2 id="summary">Summary</h2>
<ul>
<li><a href="/posts/2015/02/24/install-and-deploy-a-pelican-blog-using-fabric-part-1-local-environment.html" title="Install and deploy a Pelican blog using Fabric - Part 1: local environment">Part 1: local environment</a></li>
<li><a href="/posts/2015/02/26/install-and-deploy-a-pelican-blog-using-fabric-part-2-installation-and-configuration.html" title="Install and deploy a Pelican blog using Fabric - Part 2: installation and configuration">Part 2: installation and configuration</a></li>
<li>Part 3: Fabric<ul>
<li><a href="#versioning">Versioning</a></li>
<li><a href="#deployment-with-fabric">Deployment with Fabric</a><ul>
<li><a href="#fabfilepy">fabfile.py</a></li>
<li><a href="#provision">Provision</a></li>
<li><a href="#publish">Publish</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/posts/2015/03/04/install-and-deploy-a-pelican-blog-using-fabric-part-4-workflow-extras-and-conclusion.html" title="Install and deploy a Pelican blog using Fabric - Part 4: workflow, extras and conclusion">Part 4: workflow, extras and conclusion</a></li>
</ul>
<h2 id="versioning">Versioning</h2>
<p>The next stop in our journey is versioning. What we want to do is to be able to push our content to some repository so it can be pulled on the server later on (and it is always good to have a backup that we can clone and start working on locally in no time).</p>
<p>Create a new repo on your favorite host (like <a href="https://github.com/">GitHub</a> or <a href="https://bitbucket.org/">Bitbucket</a>) and set up your local one:</p>
<div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">init</span>
<span class="n">git</span> <span class="n">remote</span> <span class="k">add</span> <span class="n">origin</span> <span class="n">your</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">address</span>
</pre></div>


<p>Create a <em>".gitignore"</em> file (<em>".vagrant/"</em> is not required if you don't use Vagrant):</p>
<div class="highlight"><pre><span></span><span class="k">output</span><span class="cm">/*</span>
<span class="cm">*.py[cod]</span>
<span class="cm">cache/</span>
<span class="cm">.vagrant/</span>
</pre></div>


<p>We exclude the content of <em>"output/"</em> as the content will be generated directly on the live server, with its own settings.</p>
<p>Make your first commit and push your code:</p>
<div class="highlight"><pre><span></span><span class="n">git</span> <span class="k">add</span> <span class="o">-</span><span class="n">A</span>
<span class="n">git</span> <span class="k">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s1">&#39;First commit&#39;</span>
<span class="n">git</span> <span class="n">push</span>
</pre></div>


<p>That's it!</p>
<h2 id="deployment-with-fabric">Deployment with Fabric</h2>
<p><a href="http://www.fabfile.org/" title="Fabric website">Fabric</a> is a command-line tool written in Python allowing to perform remote operations over SSH. It is often used for server provisioning and deployment.</p>
<p>We installed it earlier with pip (<code>pip install Fabric</code>) and started using it already to build and serve our blog locally, using the <code>fab build</code> and <code>fab serve</code> commands among others. These commands are contained in a file named <em>"fabfile.py"</em>, at the root of your blog. We are now going to have a look at it and explain it a little bit.</p>
<h3 id="fabfilepy">fabfile.py</h3>
<p>Let's open the file in and editor and dissect it section by section:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">fabric.contrib.project</span> <span class="kn">as</span> <span class="nn">project</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">SimpleHTTPServer</span>
<span class="kn">import</span> <span class="nn">SocketServer</span>
</pre></div>


<p>Basically the imports of all the necessary libraries. <em>SimpleHTTPServer</em> is the one used by <code>fab serve</code>, for example.</p>
<div class="highlight"><pre><span></span><span class="err">#</span><span class="w"> </span><span class="k">Local</span><span class="w"> </span><span class="k">path</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="p">(</span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">absolute</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">relative</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">fabfile</span><span class="p">)</span><span class="w"></span>
<span class="n">env</span><span class="p">.</span><span class="n">deploy_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;output&#39;</span><span class="w"></span>
<span class="n">DEPLOY_PATH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">.</span><span class="n">deploy_path</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="n">Remote</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">configuration</span><span class="w"></span>
<span class="n">production</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;root@localhost:22&#39;</span><span class="w"></span>
<span class="n">dest_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/var/www&#39;</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="n">Rackspace</span><span class="w"> </span><span class="n">Cloud</span><span class="w"> </span><span class="n">Files</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">settings</span><span class="w"></span>
<span class="n">env</span><span class="p">.</span><span class="n">cloudfiles_username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;my_rackspace_username&#39;</span><span class="w"></span>
<span class="n">env</span><span class="p">.</span><span class="n">cloudfiles_api_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;my_rackspace_api_key&#39;</span><span class="w"></span>
<span class="n">env</span><span class="p">.</span><span class="n">cloudfiles_container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;my_cloudfiles_container&#39;</span><span class="w"></span>
</pre></div>


<p>This section is about configuration. We will update the <em>"Remote server configuration"</em> bit soon. We are not using <em>Rackspace</em> in this tutorial so we can just ignore this part.</p>
<p>The following function definitions (e.g. <em>"def clean()"</em>) are all the commands you can run from the terminal (using <em>"fab command_name"</em> as you already know). You are already familiar with a few of them (<code>build</code>, <code>serve</code>, <code>reserve</code>) and I encourage you to take a look at the others and try them out (you might find that you are more comfortable with some of them for your workflow). The code for most of these commands is quite self-explanatory.</p>
<p>Now let's have a look at the last one, <em>"publish"</em>:</p>
<div class="highlight"><pre><span></span><span class="p">@</span><span class="nx">hosts</span><span class="p">(</span><span class="nx">production</span><span class="p">)</span>
<span class="nx">def</span> <span class="nx">publish</span><span class="p">():</span>
    <span class="kd">local</span><span class="p">(</span><span class="s1">&#39;pelican -s publishconf.py&#39;</span><span class="p">)</span>
    <span class="nx">project.rsync_project</span><span class="p">(</span>
        <span class="n">remote_dir</span><span class="o">=</span><span class="nx">dest_path</span><span class="p">,</span>
        <span class="n">exclude</span><span class="o">=</span><span class="s2">&quot;.DS_Store&quot;</span><span class="p">,</span>
        <span class="n">local_dir</span><span class="o">=</span><span class="nx">DEPLOY_PATH.rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
        <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">extra_opts</span><span class="o">=</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>


<p>What's happenning here? First, we indicate that we want to <em>ssh</em> the host whose configuration is contained in the <em>"production"</em> variable mentioned above. Then, in the body of the function itself, we first generate the HTML <em>locally</em> using the live config (<em>"publishconf.py"</em>), and we synchronize the output with the remote server's destination directory defined by the <em>"dest_path"</em> variable and the <em>"DEPLOY_PATH"</em> environment variable.</p>
<p>The synchronization is performed using <a href="http://docs.fabfile.org/en/latest/api/contrib/project.html" title="Documentation"><code>project.rsync_project</code></a>, which is a wrapper for the <code>rsync</code> command, allowing to upload newly modified files only.</p>
<p>Basically, everything is there already for you to update a remote server with new content with a single command executed locally. And honestly that might be just enough for your needs. </p>
<p>But it implies that the remote server already exists and is properly set up. And we'd rather see the new content being pulled from our Git repository instead.</p>
<p>Now, you could just stop here for today. I won't be mad, promised.</p>
<p>But if you are interested in seeing how to update the <em>fabfile</em> to both provision our server and publish our versionned content, stick with me.</p>
<h3 id="provision">Provision</h3>
<p>Still there? Good.</p>
<p>In our context, what's behind the word <em>"provisioning"</em> is the act of installing all the required software, packages, dependencies, etc for a project to work on a server. </p>
<p>But before that, we are going to create the different error pages.</p>
<p>By default, when trying to access a page that doesn't exist for example, the default HTTP server's 404 page will be displayed.</p>
<p>And it's ugly.</p>
<p>And even if we all agree that the true beauty comes from the inside, we don't want it to be ugly.</p>
<p>Under <em>"content/pages/"</em>, create a new folder named <em>"errors/"</em> and the files <em>"403.md"</em>, <em>"404.md"</em> and <em>"50x.md"</em> in it (adapt the extensions to the format you chose).</p>
<p>Here is the content of my <em>404</em> page as an example:</p>
<div class="highlight"><pre><span></span><span class="nl">Title</span><span class="p">:</span> <span class="n">Hmm</span><span class="p">...</span>
<span class="nl">Slug</span><span class="p">:</span> <span class="mi">404</span>
<span class="nl">Status</span><span class="p">:</span> <span class="n">hidden</span>

<span class="n">Nope</span><span class="p">.</span> <span class="n">Don</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">know</span> <span class="n">what</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">talking</span> <span class="n">about</span><span class="p">,</span> <span class="n">pal</span><span class="p">.</span>

<span class="p">[</span><span class="n">Go</span> <span class="n">home</span><span class="p">](</span><span class="o">/</span> <span class="s">&quot;Back to home&quot;</span><span class="p">).</span>
</pre></div>


<p>Not much new here, except for the <em>"hidden"</em> status, whose effect is to prevent it from being displayed along with the other pages (<em>"about"</em> etc).</p>
<p>Follow the same format for the two other pages.</p>
<p>When you are done, create a new file called <em>"blog.conf"</em> under the <em>".provision/"</em> directory, with this content:</p>
<div class="highlight"><pre><span></span><span class="nv">server</span> {
    <span class="nv">listen</span> <span class="mi">80</span><span class="c1">; ## listen for ipv4; this line is default and implied</span>
    <span class="nv">listen</span> [::]:<span class="mi">80</span> <span class="nv">default</span> <span class="nv">ipv6only</span><span class="o">=</span><span class="nv">on</span><span class="c1">; ## listen for ipv6</span>

    # <span class="nv">Make</span> <span class="nv">site</span> <span class="nv">accessible</span> <span class="nv">from</span> <span class="nv">http</span>:<span class="o">//</span><span class="nv">my</span><span class="o">-</span><span class="nv">blog</span>.<span class="nv">local</span>.<span class="nv">com</span>
    <span class="nv">server_name</span> <span class="nv">my</span><span class="o">-</span><span class="nv">blog</span>.<span class="nv">local</span>.<span class="nv">com</span><span class="c1">;</span>
    <span class="nv">root</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">www</span><span class="o">/</span><span class="nv">blog</span><span class="c1">;</span>

    <span class="nv">location</span> <span class="o">=</span> <span class="o">/</span> {
        # <span class="nv">Instead</span> <span class="nv">of</span> <span class="nv">handling</span> <span class="nv">the</span> <span class="nv">index</span>, <span class="nv">just</span>
        # <span class="nv">rewrite</span> <span class="o">/</span> <span class="nv">to</span> <span class="o">/</span><span class="nv">index</span>.<span class="nv">html</span>
        <span class="nv">rewrite</span> <span class="o">^</span> <span class="o">/</span><span class="nv">index</span>.<span class="nv">html</span><span class="c1">;</span>
    }

    <span class="nv">location</span> <span class="o">/</span> {
        <span class="nv">try_files</span> $<span class="nv">uri</span>.<span class="nv">htm</span> $<span class="nv">uri</span>.<span class="nv">html</span> $<span class="nv">uri</span> <span class="o">=</span><span class="mi">404</span><span class="c1">;</span>
    }

    <span class="nv">access_log</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span><span class="o">/</span><span class="nv">blog</span><span class="o">/</span><span class="nv">access</span>.<span class="nv">log</span><span class="c1">;</span>
    <span class="nv">error_log</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span><span class="o">/</span><span class="nv">blog</span><span class="o">/</span><span class="nv">error</span>.<span class="nv">log</span><span class="c1">;</span>

    # <span class="nv">Redirect</span> <span class="nv">server</span> <span class="nv">error</span> <span class="nv">pages</span>
    <span class="nv">error_page</span> <span class="mi">500</span> <span class="mi">502</span> <span class="mi">503</span> <span class="mi">504</span> <span class="o">/</span><span class="nv">pages</span><span class="o">/</span><span class="mi">50</span><span class="nv">x</span>.<span class="nv">html</span><span class="c1">;</span>
    <span class="nv">error_page</span> <span class="mi">404</span> <span class="o">/</span><span class="nv">pages</span><span class="o">/</span><span class="mi">404</span>.<span class="nv">html</span><span class="c1">;</span>
    <span class="nv">error_page</span> <span class="mi">403</span> <span class="o">/</span><span class="nv">pages</span><span class="o">/</span><span class="mi">403</span>.<span class="nv">html</span><span class="c1">;</span>
}
</pre></div>


<p>You may have recognized the nginx format: it is indeed the HTTP server I am going to use (feel free to adapt this to your favorite one).</p>
<p>This is a rather basic config: the website will be accessible at <em>http://my-blog.local.com</em>, its root will be <em>"/var/www/blog/"</em> on the remote server, the logs will be written under <em>"/var/log/blog/"</em>, and the errors will be redirected to the different pages you have just created.</p>
<p>Now, open back <em>"fabfile.py"</em> and, before the <em>"publish"</em> function, add a <em>"provision"</em> one (it could be after as well, but the provisioning is supposed to come <em>before</em> the publication, right? But maybe that is just my OCD speaking):</p>
<div class="highlight"><pre><span></span>@<span class="nv">hosts</span><span class="ss">(</span><span class="nv">production</span><span class="ss">)</span>
<span class="nv">def</span> <span class="nv">provision</span><span class="ss">()</span>:
    <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">nginx -v</span><span class="s1">&#39;</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">apt-get -y install nginx</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">rm /etc/nginx/sites-available/default</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">service nginx start</span><span class="s1">&#39;</span><span class="ss">)</span>
    <span class="nv">put</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">./.provision/blog.conf</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">/etc/nginx/sites-available/blog.conf</span><span class="s1">&#39;</span>, <span class="nv">use_sudo</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>
    <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">rm -f /etc/nginx/sites-enabled/blog.conf</span><span class="s1">&#39;</span><span class="ss">)</span>
    <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">ln -s /etc/nginx/sites-available/blog.conf /etc/nginx/sites-enabled/blog.conf</span><span class="s1">&#39;</span><span class="ss">)</span>

    <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">test -d %s/%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="ss">(</span><span class="nv">log_path</span>, <span class="nv">sitename</span><span class="ss">)</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">mkdir %s/%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="ss">(</span><span class="nv">log_path</span>, <span class="nv">sitename</span><span class="ss">))</span>

    <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">test -d %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">root_path</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">mkdir %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">root_path</span><span class="ss">)</span>

    <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">git -v</span><span class="s1">&#39;</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">apt-get install -y git-core</span><span class="s1">&#39;</span><span class="ss">)</span>

    <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">pip --version</span><span class="s1">&#39;</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
        <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">wget https://raw.github.com/pypa/pip/master/contrib/get-pip.py -P /tmp/</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">python /tmp/get-pip.py</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">rm /tmp/get-pip.py</span><span class="s1">&#39;</span><span class="ss">)</span>

    <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">fab --version</span><span class="s1">&#39;</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">pip install Fabric</span><span class="s1">&#39;</span><span class="ss">)</span>

    <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">virtualenv --version</span><span class="s1">&#39;</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">pip install virtualenv</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">pip install virtualenvwrapper</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">echo &quot;export WORKON_HOME=$HOME/.virtualenvs&quot; &gt;&gt; /home/vagrant/.bashrc</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">echo &quot;source /usr/local/bin/virtualenvwrapper.sh&quot; &gt;&gt; /home/vagrant/.bashrc</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">with</span> <span class="nv">prefix</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">WORKON_HOME=$HOME/.virtualenvs</span><span class="s1">&#39;</span><span class="ss">)</span>:
            <span class="nv">with</span> <span class="nv">prefix</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">source /usr/local/bin/virtualenvwrapper.sh</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">mkvirtualenv %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">sitename</span><span class="ss">)</span>

    <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">service nginx restart</span><span class="s1">&#39;</span><span class="ss">)</span>
</pre></div>


<p>Quite a few things here but, if you look closely, you will realize these are basically all the steps you have taken at the beginning of the tutorial.</p>
<p>The pattern is almost always the same:</p>
<ul>
<li>test if the package is installed (<code>if run('package --version', warn_only=True).failed:</code>)</li>
<li>install it if it is not</li>
</ul>
<p>The <em>"warn_only=True"</em> parameter allows Fabric not to exit in case of a command failure: this is exactly what we want, i.e. knowing if the command fails so we can install the missing package.</p>
<p><em>"with prefix"</em> allows to execute the subsequent commands in the context of the current one. If your version of Python is prior to 2.6, you will need to add <code>from __future__ import with_statement</code> at the top of the file.</p>
<p>We will <em>ssh</em> the <em>"server"</em> box as the <em>"vagrant"</em> user, meaning the <em>"run"</em> commands will be executed with its permissions, and the <em>"sudo"</em> ones with the root permissions, just like we did throughout this tutorial.</p>
<p>Back to the actual script: we first install nginx if necessary (and remove the default config), start it, copy the server config file we created earlier to the right location, and recreate the symlink.</p>
<p>Then we ensure the destination directories for the logs and the blog's generated HTML exist, that Git is installed, then pip, Fabric, virtualenv and virtualenvwrapper, we create the <em>"blog"</em> virtual environment and, finally, we restart nginx.<br />
Again, if you followed this tutorial from the start, this should feel familiar.</p>
<p>Now as I am using <em>Ubuntu 14.04.1 LTS</em> boxes, I <em>know</em> my <em>"remote"</em> server comes with Python preinstalled. If yours doesn't, well you will have to add the steps to install it :)</p>
<p>Shall we test this now? Sure thing, but we need to do something first. Remember the configuration section of <em>"fabfile.py"</em> mentioned earlier? It is time to set up the details of our remote server. This is where the use of Vagrant comes in handy as, if you used the Vagrant config I gave you at the beginning of this post, then the <em>"remote server"</em> box is already there, reporting for duty.</p>
<p>Open a new terminal on your host machine, go to the blog's root, and type this:</p>
<div class="highlight"><pre><span></span><span class="n">vagrant</span> <span class="n">up</span> <span class="n">server</span>
</pre></div>


<p>Now update <em>"fabfile.py"</em>, changing the server configuration for this one:</p>
<div class="highlight"><pre><span></span><span class="cp"># Remote server configuration</span>
<span class="n">production</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">vagrant</span><span class="mf">@192.168.72.3</span><span class="o">:</span><span class="mi">22</span><span class="err">&#39;</span>
<span class="n">env</span><span class="p">.</span><span class="n">key_filename</span> <span class="o">=</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">insecure_private_key</span><span class="err">&#39;</span>
<span class="n">root_path</span> <span class="o">=</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="err">&#39;</span>
<span class="n">log_path</span> <span class="o">=</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="err">&#39;</span>
<span class="n">dest_path</span> <span class="o">=</span> <span class="err">&#39;</span><span class="o">~/</span><span class="n">dev</span><span class="err">&#39;</span>
<span class="n">sitename</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">blog</span><span class="err">&#39;</span>
<span class="n">symlink_folder</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">output</span><span class="err">&#39;</span>
</pre></div>


<p>The IP address is the one that was specified in the Vagrant config, and the private SSH key is the Vagrant one, copied over from the host machine, via this line of the config:</p>
<div class="highlight"><pre><span></span><span class="o">#</span> <span class="k">Copy</span> <span class="n">the</span> <span class="k">default</span> <span class="n">Vagrant</span> <span class="n">ssh</span> <span class="n">private</span> <span class="k">key</span> <span class="n">over</span>
<span class="k">local</span><span class="p">.</span><span class="n">vm</span><span class="p">.</span><span class="n">provision</span> <span class="ss">&quot;file&quot;</span><span class="p">,</span> <span class="k">source</span><span class="p">:</span> <span class="ss">&quot;~/.vagrant.d/insecure_private_key&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="ss">&quot;~/.ssh/insecure_private_key&quot;</span>
</pre></div>


<p>As mentioned earlier, we will <em>ssh</em> the box as the <em>"vagrant"</em> user. The rest of the variables are path/folder names used in both the <em>"provision"</em> and <em>"publish"</em> functions (next section). </p>
<p>Now, from the <em>"local"</em> Vagrant machine:</p>
<div class="highlight"><pre><span></span><span class="n">fab</span> <span class="n">provision</span>
</pre></div>


<p>If everything is set up properly, you should see a series of text lines scrolling off the screen: your <em>"server"</em> box is being provisionned :)</p>
<p>When it is done, you can <em>ssh</em> your <em>"server"</em> VM and play around to observe that everything was properly installed:</p>
<div class="highlight"><pre><span></span><span class="n">vagrant</span> <span class="n">ssh</span> <span class="n">server</span>
</pre></div>


<h3 id="publish">Publish</h3>
<p>We are now able to provision a server with everything required to run our blog, and all it takes is to update a few lines of configuration in <em>"fabfile.py"</em> and running one command.</p>
<p>Pretty cool, eh?</p>
<p>Anyway, we are yet to update the <em>"publish"</em> function to automate the publication of new content, pulling it from our Git repository.</p>
<p>Here is what it looks like:</p>
<div class="highlight"><pre><span></span>@<span class="nv">hosts</span><span class="ss">(</span><span class="nv">production</span><span class="ss">)</span>
<span class="nv">def</span> <span class="nv">publish</span><span class="ss">()</span>:
    <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">cat ~/.ssh/id_rsa.pub</span><span class="s1">&#39;</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
        <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">ssh-keygen -N &quot;&quot; -f ~/.ssh/id_rsa</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">key</span> <span class="o">=</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">cat ~/.ssh/id_rsa.pub</span><span class="s1">&#39;</span><span class="ss">)</span>
        <span class="nv">prompt</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">Add this key to your Git repository and then hit return:</span><span class="se">\n\n</span><span class="s">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nv">key</span><span class="ss">)</span>

    <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">test -d %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">dest_path</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
        <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">mkdir %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">dest_path</span><span class="ss">)</span>

    <span class="nv">with</span> <span class="nv">cd</span><span class="ss">(</span><span class="nv">dest_path</span><span class="ss">)</span>:
        <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">test -d %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">sitename</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
            <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">mkdir %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">sitename</span><span class="ss">)</span>
            <span class="nv">with</span> <span class="nv">cd</span><span class="ss">(</span><span class="nv">sitename</span><span class="ss">)</span>:
                <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">git clone %s .</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">git_repository</span><span class="ss">)</span>
                <span class="k">if</span> <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">test -d %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">symlink_folder</span>, <span class="nv">warn_only</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>.<span class="nv">failed</span>:
                    <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">mkdir %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">symlink_folder</span><span class="ss">)</span>
                <span class="nv">sudo</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">ln -s %s/%s/%s %s/%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="ss">(</span><span class="nv">dest_path</span>, <span class="nv">sitename</span>, <span class="nv">symlink_folder</span>, <span class="nv">root_path</span>, <span class="nv">sitename</span><span class="ss">))</span>

        <span class="nv">with</span> <span class="nv">cd</span><span class="ss">(</span><span class="nv">sitename</span><span class="ss">)</span>:
            <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">git reset --hard HEAD</span><span class="s1">&#39;</span><span class="ss">)</span>
            <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">git pull origin master</span><span class="s1">&#39;</span><span class="ss">)</span>
            <span class="nv">with</span> <span class="nv">prefix</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">WORKON_HOME=$HOME/.virtualenvs</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="nv">with</span> <span class="nv">prefix</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">source /usr/local/bin/virtualenvwrapper.sh</span><span class="s1">&#39;</span><span class="ss">)</span>:
                    <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">workon %s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nv">sitename</span><span class="ss">)</span>
                    <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">pip install -r requirements.txt</span><span class="s1">&#39;</span><span class="ss">)</span>
                    <span class="nv">run</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">fab preview</span><span class="s1">&#39;</span><span class="ss">)</span>
</pre></div>


<p>First, we check if there is an existing SSH private key for the <em>"vagrant"</em> user (or whatever user you set up): we are going to pull the content from a Git repository over SSH, so we need one. If none is found, the script will generate one for us and display it so we can add it to our repo. Once this is done, just hit <em>return</em> to continue the execution.</p>
<p>The destination path is then created if necessary: in our case, the repository is cloned and updated in <em>"~/dev/blog"</em>. From there, a symlink is created between <em>"~/dev/blog/output"</em> and <em>"/var/www/blog"</em>, so the generated HTML files alone are in <em>"/var/www/blog"</em>.</p>
<p>Finally, the Virtual Environment is activated, the pip dependencies installed, and the content generated with the live config.</p>
<p>Let's test our new function:</p>
<div class="highlight"><pre><span></span><span class="n">fab</span> <span class="n">publish</span>
</pre></div>


<p>Once the execution is over, you should be able to see your blog at the private IP address <a href="http://192.168.72.3">192.168.72.3</a>.</p>
<p>There is one last little step to take to access it from the server name as defined in the nginx config. Open the <em>"hosts"</em> file of your host machine and add the following line (change the domain for the one you chose, if different):</p>
<div class="highlight"><pre><span></span><span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">72</span><span class="p">.</span><span class="mi">3</span>    <span class="n">my</span><span class="o">-</span><span class="n">blog</span><span class="p">.</span><span class="k">local</span><span class="p">.</span><span class="n">com</span>
</pre></div>


<p>You can now access <a href="http://my-blog.local.com">http://my-blog.local.com</a>.</p>
<p>That's it! You now know how to provision a server and publish your content using Fabric.</p>
<p>In the <a href="/posts/2015/03/04/install-and-deploy-a-pelican-blog-using-fabric-part-4-workflow-extras-and-conclusion.html" title="Install and deploy a Pelican blog using Fabric - Part 4: workflow, extras and conclusion">next part</a>, we will review a complete workflow, implement a few extra things and conclude this tutorial with a few openings on what to do to go further.</p>

    <div class="sharethis-inline-share-buttons"></div>

    <section class="info">
      <span class="title">Enjoying the content?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p class="meta">
      <small>
        Last updated by osteel on
          <time datetime="2015-03-04" pubdate>2015-03-04</time>
          :: [
          <a href="https://tech.osteel.me/tag/vagrant">vagrant</a>
          <a href="https://tech.osteel.me/tag/fabric">fabric</a>
          <a href="https://tech.osteel.me/tag/tutorial">tutorial</a>
          <a href="https://tech.osteel.me/tag/python">python</a>
          <a href="https://tech.osteel.me/tag/blog">blog</a>
          <a href="https://tech.osteel.me/tag/pelican">pelican</a>
          ]
      </small>
    </p>

    <section>
      <h2>Comments</h2>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
    </section>
  </div>
</div>
      </div>

      <label for="sidebar-checkbox" class="sidebar-toggle"></label>

      <script>
        (function(document) {
          var i = 0;
          // snip empty header rows since markdown can't
          var rows = document.querySelectorAll('tr');
          for(i=0; i<rows.length; i++) {
            var ths = rows[i].querySelectorAll('th');
            var rowlen = rows[i].children.length;
            if (ths.length > 0 && ths.length === rowlen) {
              rows[i].remove();
            }
          }
        })(document);
      </script>

      <script>
        /* Lanyon & Poole are Copyright (c) 2014 Mark Otto. Adapted to Pelican 20141223 and extended a bit by @thomaswilley */
        (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');
          document.addEventListener('click', function(e) {
            var target = e.target;
            if(!checkbox.checked ||
            sidebar.contains(target) ||
            (target === checkbox || target === toggle)) return;
            checkbox.checked = false;
            }, false);
            })(document);
      </script>


      <script type="text/javascript">
        var disqus_shortname = "osteel";
              var disqus_identifier = "/posts/install-and-deploy-a-pelican-blog-using-fabric-part-3-fabric";
              var disqus_url = "https://tech.osteel.me/posts/install-and-deploy-a-pelican-blog-using-fabric-part-3-fabric";
              var disqus_title = "Install and deploy a Pelican blog using Fabric - Part 3: Fabric";
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
      </script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53994673-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53994673-2');
    ga('send', 'pageview');
</script>

     </div>
  </body>
</html>