<!DOCTYPE html>
<html lang="en">
  <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
    <link rel="shortcut icon" type="image/x-icon" href="https://tech.osteel.me/favicon.ico" />

    <meta name="author" content="Yannick Chenot"/>
    <meta property="og:image" content="https://tech.osteel.me/images/year/month/day/" />

    <meta name="google-site-verification" content="KhtQOQ0ZVgZ55KSEoXMOWo_seu_e_JbV6xBk_SuewYI" />

    <meta name="monetization" content="$ilp.uphold.com/miU94ZyFdQ6K">

    <title>Building a PHP CLI tool using DDD and Event Sourcing. Part 3: code design &mdash; osteel's blog</title>

    <meta charset="utf-8" />
    <link href="https://tech.osteel.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Full Atom Feed" />
    <link href="https://tech.osteel.me/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog Full RSS Feed" />
    <link href="https://tech.osteel.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Atom Feed" />
    <link href="https://tech.osteel.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog RSS Feed" />
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/poole.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/syntax.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/lanyon.css"/>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/styles.css"/>

    <script
      type="text/javascript"
      src="https://platform-api.sharethis.com/js/sharethis.js#property=5e6053b434311400122fd1f8&product=inline-share-buttons"
      async="async">
    </script>




  <meta name="tags" content="" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@osteel">
  <meta name="twitter:creator" content="@osteel">
  <meta name="twitter:title" content="Building a PHP CLI tool using DDD and Event Sourcing. Part 3: code design">
  <meta name="twitter:image" content="https://tech.osteel.me/images/year/month/day/">

  </head>

  <body>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="profile">
      <img src="https://www.gravatar.com/avatar/158eb527bb4ceb8e1a84e74b39815b71"/>
    </div>
  </div>

  <section>
    <p>Demat ! I'm Yannick, a senior backend developer based in Brighton, UK.</p>
  </section>

  <section>
    <ul class="sidebar-nav">
    </ul>
  </section>

  <section>
    <h2>Newsletter</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
      <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="Email address" required>
      <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
      <input type="submit" hidden />
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
    </form>
  </section>

  <section>
    <h2>Categories</h2>
    <nav class="sidebar-nav">
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/blogging">Blogging</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/business">Business</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/devops">DevOps</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/laravel">Laravel</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/misc">Misc</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/php">PHP</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/productivity">Productivity</a>

    </nav>
  </section>

  <section>
    <h2>Search</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://tech.osteel.me/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
        <input class="form-input" type="text" name="q" placeholder="Search" />
    </form>
  </section>

    <section>
        <h2>Find me</h2>
        <ul class="sidebar-nav">
            <li><a class="sidebar-nav-item" href="https://github.com/osteel" target="_blank">GitHub</a></li>
            <li><a class="sidebar-nav-item" href="https://twitter.com/osteel" target="_blank">Twitter</a></li>
            <li><a class="sidebar-nav-item" href="https://www.linkedin.com/in/yannickchenot" target="_blank">LinkedIn</a></li>
        </ul>
    </section>

  <section>
    <h2>Feeds</h2>
    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">All posts&nbsp;
        [&nbsp;
 <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a>        &nbsp;
 <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a>        &nbsp;]
      </li>
    </ul>
  </section>

  <div class="sidebar-item">
    <p>
    <a href="https://twitter.com/osteel">&copy; @osteel</a> 2023
    </p>
    <p class="tiny-note">
      Powered by <a href="http://getpelican.com">Pelican</a> :: Theme based on <a class="muted" href="https://github.com/thomaswilley/pelicanyan">Pelicanyan</a>
    </p>
  </div>
</div>    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://tech.osteel.me/" title="Home">osteel's blog</a>
            <small>Web development resources</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="posts">
<div class="post">
    <h1 class="post-title">
      Building a PHP CLI tool using DDD and Event Sourcing. Part 3: code design
    </h1>
    <span class="post-date">
      <small>
          Last updated: 1970-01-01 ::
        Published: 1970-01-01
          :: [ <a href="https://github.com/osteel/blog-tech-public/commits/master/drafts/a-crypto-activity-tracking-tool-part-3-code-design.html">history</a> ]
      </small>
    </span>

    <section class="info">
      <span class="title">Been here before?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p><img alt="Caption" src="/images//.jpg" title="Caption" /></p>
<p class="info"><span class="title">Title</span> Content</p>

<div class="info"><p><span class="title">Title</span> Content</p></div>

<p>Plain code block:</p>
<div class="highlight"><pre><span></span>
</pre></div>


<p>Code block with line numbers:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
</pre></div>
</td></tr></table>

<p>When I started this series, I wasn't sure whether I would need to write this post. What I'm referring to as "code design" here is technically still part of the model, and when searching for inspiration online I found many examples of models containing rather specific implementation details. But as per DDD, the model is also supposed to be understood by domain experts, so they can validate it. How can we expect them to know what a repository or an aggregate root is?</p>
<p>I decided to use this as a guideline and to draw a line between what non-developers would and wouldn't understand. This led to two separate articles – one covering the <em>abstract</em> model (the previous post) and the other covering the <em>implementation</em> model (this post). This also allowed me to go as technical as I wanted to in the latter.</p>
<h2 id="in-this-post">In this post</h2>
<div class="toc">
<ul>
<li><a href="#in-this-post">In this post</a></li>
<li><a href="#domain-driven-design">Domain-Driven Design</a></li>
<li><a href="#event-sourcing">Event Sourcing</a></li>
<li><a href="#layered-architecture">Layered architecture</a></li>
<li><a href="#code-design">Code design</a></li>
<li><a href="#folder-structure">Folder structure</a></li>
<li><a href="#misc-to-sort-out">Misc (to sort out)</a></li>
<li><a href="#implementation-plan">Implementation plan</a></li>
<li><a href="#closing-thoughts">Closing thoughts</a></li>
</ul>
</div>
<h2 id="domain-driven-design">Domain-Driven Design</h2>
<p>Before I get into the nitty-gritty of the implementation, I need to get some base concepts out of the way, starting with DDD. You may want to skip this section if you are already familiar with the matter.</p>
<p>Domain-Driven Design is both an approach and a set of tools that includes a bunch of object-oriented design patterns. DDD and Object-Oriented Programming (OOP) work well together because they both aim at representing real world concepts and relationships as code. This is also why you will most likely recognise some of the following patterns, even if you've never worked with DDD.</p>
<p><em>Entity:</em> An entity is an object that has an identity that remains the same within a system – sometimes beyond. Entities are usually referred to as <em>models</em> in non-DDD contexts, and are persisted throughout the states of the software.</p>
<p><em>Value object:</em> On the other hand, value objects are defined by their attributes and have no identity. They describe a particular aspect of the domain, and are usually immutable. When different values are needed, a new object is created.</p>
<p><em>Service:</em> Sometimes, a particular operation does not belong to an entity nor a value object. Such behaviour can be implemented in a service. A service does not matter as an object, but in what it does to other objects from the domain, for which it is a connection point. Services have no state – they provide functionality for the domain.</p>
<p>Services don't always belong to the domain, however, and can provide utility for other layers.</p>
<p><em>Factory:</em> Factories contain logic to create other objects, when that process is too complex for a constructor, or it requires creating several objects together, for instance.</p>
<p><em>Repository:</em> Repositories are used to save and retrieve entities. They don't create them (that's the job of the factories) but persist them in the storage layer. They contain any logic to retrieve specific objects from that persistence layer, like applying filters. They are a way to decouple the domain from the underlying storage infrastructure.</p>
<p>There are other DDD patterns that belong to a larger pattern that it's worth exploring as a whole – Event Sourcing.</p>
<h2 id="event-sourcing">Event Sourcing</h2>
<p>"A pragmatic introduction to Event Sourcing" https://www.youtube.com/watch?v=xHbP3bshU3U</p>
<blockquote>
<p>Event sourcing tries to solve this problem by storing all events that happen in your app. The state of your application is built by listening to those events. An aggregate is used to validate if a new event is allowed to get written and to make decisions based on the past. Projectors are used to transform newly written events into a format useful for consumption in your app.</p>
</blockquote>
<p>– https://github.com/spatie/laravel-event-sourcing/blob/main/docs/getting-familiar-with-event-sourcing/introduction.md</p>
<p>Event Sourcing is a software pattern whereby the successive states of an object are stored, instead of the current state only. That means the whole history of an object is stored, and to get the current state of an object you need to replay the past events up until the most recent one.</p>
<p>A typical example is a bank statement – instead of just giving you the amount currently available on your account, the statement will list all the operations performed on the account that led to the current amount.</p>
<p>Event Sourcing is considered a pattern of DDD and it has its own patterns, some of which are briefly explained below.</p>
<p><em>Aggregate:</em> The most important pattern of Event Sourcing is the aggregate. An aggregate is a group of objects that are held together through an entity called the aggregate root, which is also the only way to change the aggregate from the outside. The objects in the aggregate constitute a single unit forming a relationship through data.</p>
<p><em>Invariant:</em> </p>
<blockquote>
<p>A collection of objects that are bound together by a root entity, otherwise known as an aggregate root. The aggregate root guarantees the consistency of changes being made within the aggregate by forbidding external objects from holding references to its members.</p>
<p>The invariants are those rules which have to be maintained whenever data changes.</p>
<p>An Aggregate is a group of associated objects which are considered as one unit with regard to data changes. The Aggregate is demarcated by a boundary which separates the objects inside from those outside. Each Aggregate has one root. The root is an Entity, and it is the only object accessible from outside. If there are other Entities inside the boundary, the identity of those entities is local, making sense only inside the aggregate.</p>
<p>Since other objects can hold references only to the root, it means that they cannot directly change the other objects in the aggregate. All they can do is to change the root, or ask the root to perform some actions. And the root will be able to change the other objects, but that is an operation contained inside the aggregate, and it is controllable. If the root is deleted and removed from memory, all the other objects from the aggregate will be deleted too, because there is no other object holding reference to any of them.</p>
<p>Cluster the Entities and Value Objects into Aggregates and define boundaries around each. Choose one Entity to be the root of each Aggregate, and control all access to the objects inside the boundary through the root. Allow external objects to hold references to the root only. Transient references to internal members can be passed out for use within a single operation only. Because the root controls access, it cannot be blindsided by changes to the internals. This arrangement makes it practical to enforce all invariants for objects in the Aggregate and for the Aggregate as a whole in any state change.</p>
</blockquote>
<p>Event: something that happened in the past, immutable. Value object. Recorded on the aggregate, to <em>reconstitute</em> the aggregate.</p>
<blockquote>
<p>Domain events can be used to model distributed systems. The model will become more complex, but it can be more scalable. Domain Events are often used in an Event Driven Architecture.</p>
</blockquote>
<p>Aggregate root repository: for storing recorded events and reconstituting aggregates.</p>
<p>Message: wrapper for an event containing additional metadata (aggregate ID, event type, etc.).</p>
<p>Message repository: persist and retrieve messages. Can work with any storage type.</p>
<p>Message dispatcher: transport messages. RabbitMQ, Kafka, sync, whatever.</p>
<p>Projector (called "projection" in EventSauce and is a type of consumer): reacts to events and use their data to create projections (called "read models" in EventSauce and are basically views). You can replay them.</p>
<p>Projection (called "read model" in EventSauce): view of the event data, optimised for reading.</p>
<p>Reactor: consumer that perform actions beyond updating read models (e.g. send emails). You don't replay them.</p>
<h2 id="layered-architecture">Layered architecture</h2>
<p>The last concept I want to introduce before getting into the implementation details in the layered architecture.</p>
<blockquote>
<p>In an object-oriented program, UI, database, and other support code often gets written directly into the business objects. Additional business logic is embedded in the behavior of UI widgets and database scripts. This sometimes happens because it is the easiest way to make things work quickly. However, when domain-related code is mixed with the other layers, it becomes extremely difficult to see and think about.</p>
<p>Partition a complex program into layers. Develop a design within each layer that is cohesive and that depends only on the layers below. Follow standard architectural patterns to provide loose coupling to the layers above. Concentrate all the code related to the domain model in one layer and isolate it from the user interface, application, and infrastructure code. The domain objects, free of the responsibility of displaying themselves, storing themselves, managing application tasks, and so forth, can be focused on expressing the domain model</p>
<p>User Interface (Presentation Layer): Responsible for presenting information to the user and interpreting user commands.
Application Layer: This is a thin layer which coordinates the application activity. It does not contain business logic. It does not hold the state of the business objects, but it can hold the state of an application task progress.
Domain Layer: This layer contains information about the domain. This is the heart of the business software. The state of business objects is held here. Persistence of the business objects and possibly their state is delegated to the infrastructure layer.
Infrastructure Layer: This layer acts as a supporting library for all the other layers. It provides communication between layers, implements persistence for business objects, contains supporting libraries for the user interface layer, etc.</p>
<p>One of the most common patterns for managing separation of concerns is through use of a layered architecture.</p>
<p>The layers capture the related parts of the application. The parts that change for similar reasons are kept together (cohesion) and are separated out from less heavily associated parts of the program (decoupling). Any layer should depend only on parts of itself or the layers below it. This gives us the ability to work in one area of the application without having to worry about other concerns.</p>
</blockquote>
<p>Layered architecture – presentation, application, domain, infrastructure.</p>
<p>Presentation: console input output, commands (Laravel ones)</p>
<p>Application: jobs, concrete (Eloquent) repositories, providers, exceptions</p>
<p>Domain: entities, aggregates, value objects, services, factories, repository interfaces, consumers (projectors), read models (projections)</p>
<p>Infrastructure: config, storage, database, queues, eloquent models, vendors</p>
<blockquote>
<p>Nothing in a lower layer can know anything at all about something in a higher layer.
In other words, the code on the lower layers should not depend on the code on the higher layers. The code at the higher levels should depend only on the code at one level below.</p>
</blockquote>
<p>– https://medium.com/@pogulailo/domain-driven-design-and-clean-architecture-in-php-part-1-layers-and-structure-edcce57be42a</p>
<h2 id="code-design">Code design</h2>
<p>In fact, the concept of tax year is a good candidate for an <em>aggregate root</em> – the main entity of an aggregate, a group of domain objects treated as a single unit. In our case, this aggregate would comprise the tax year as well as its relevant taxable events.</p>
<p>As mentioned in the model article, I've decided not to split it in bounded contexts nor modules, which will also simplify the structure of the application (modules would belong to bounded contexts, although there can be modules without bounded contexts as well).</p>
<blockquote>
<p>Imagine our domain use-case contains sending an e-mail, but our domain is not about sending emails. Then we can create an interface that will do the sending e-mail use-case. We use this interface in the domain layer and thus keep the domain layer clean, separated.</p>
<p>Another typical domain interface is a repository.</p>
</blockquote>
<p>– https://medium.com/carvago-development/domain-driven-design-handbook-4d34b069bec4</p>
<p>Value objects: transaction, fiat amount, acquisition, disposal, transfer, airdrop, swap, fee</p>
<p>Enums: currency</p>
<p>https://matthiasnoback.nl/2022/09/is-it-a-dto-or-a-value-object/</p>
<p>Entities/aggregates: tax year, share pooling, nft</p>
<p>Tax year events: capitalGainRecorded, capitalGainReverted, capitalLossRecorded, capitalLossReverted, incomeRecorded, nonAttributableAllowableCostRecorded</p>
<p>Projection for tax years to get current capital gains, income and non-attributable allowable costs without having to replay all events.</p>
<p>Share pooling events: sharePoolingTokenAcquired, sharePoolingTokenDisposedOf, sharePoolingTokenDisposalReverted</p>
<p>Nft events: nftAcquired, nftCostBasisIncreased, nftDisposedOf</p>
<p>Services: TransactionConsumer (breaks down incoming transactions and passes them on to the right handler. E.g. in the case of a transfer, it extracts the fee and makes it a Disposal value object to pass on to the Section104PoolHandler service. The rest of the transaction is passed on to the TransferHandler service), Section104PoolHandler (with rules – same-day, 30-days and section 104 pool), TransferHandler, NftHandler, AirdropHandler</p>
<p>Diagram</p>
<h2 id="folder-structure">Folder structure</h2>
<p>I have read many articles on the topic but the one that influenced me the most in the end was <a href="https://lorisleiva.com/conciliating-laravel-and-ddd">Conciliating Laravel and DDD </a> by <a href="https://twitter.com/lorismatic">Loris Leiva</a>. The main takeaway for me was that it's counterproductive to fight the framework. Keeping this principle in mind, all the layers but the domain one are basically mixed up in the <code>app/</code> folder of the framework – and that's fine.</p>
<p>In practice, that means the only new folder I created at the root is <code>domain/</code>, which I added to the PSR-4 autoload mapping section of <code>composer.json</code>:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;autoload&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;psr-4&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;App\\&quot;</span><span class="p">:</span> <span class="s2">&quot;app/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Domain\\&quot;</span><span class="p">:</span> <span class="s2">&quot;domain/src/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Database\\Factories\\&quot;</span><span class="p">:</span> <span class="s2">&quot;database/factories/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Database\\Seeders\\&quot;</span><span class="p">:</span> <span class="s2">&quot;database/seeders/&quot;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="err">,</span>
<span class="s2">&quot;autoload-dev&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;psr-4&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;Tests\\&quot;</span><span class="p">:</span> <span class="s2">&quot;tests/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Domain\\Tests\\&quot;</span><span class="p">:</span> <span class="s2">&quot;domain/tests/&quot;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="err">,</span>
</pre></div>


<p>Note that I also decided to keep the domain-related tests next to the domain, meaning the <code>domain/</code> folder has two subfolders <code>src/</code> and <code>tests/</code>, both mapped above.</p>
<h2 id="misc-to-sort-out">Misc (to sort out)</h2>
<p>Submitting a spreadsheet erases existing records and starts over.</p>
<p>Only two bounded contexts belong to the application – <em>submit</em> and <em>review</em>. Make modules out of them?</p>
<p>Once the job is dispatched, record and report errors at the end instead of interrupting the import?</p>
<p>Use the "sync" driver for events.</p>
<p>dime process transactions.csv</p>
<p>=&gt; do you want to review now?</p>
<p>=&gt; do you want to export now?</p>
<p>dime review</p>
<p>=&gt; please import some transactions first</p>
<p>=&gt; do you want to export now?</p>
<p>dime export</p>
<p>=&gt; please import some transactions first</p>
<h2 id="implementation-plan">Implementation plan</h2>
<p>Start with the aggregates as they can be built in isolation. Then implement the logic connecting them. Finally, build the presentation layer.</p>
<h2 id="closing-thoughts">Closing thoughts</h2>
<p>This post is likely the last one purely within the framework of Domain-Driven Design. The code design phase closes the feedback loop opened with the description of the domain and its model, and the three phases will now keep feeding into each other to get a software that represents and addresses more and more accurately identified domain issues.</p>
<p>The following articles will cover more specific aspects of the implementation, like Event Sourcing, Test-Driven Development and developing with Laravel Zero, which will be the focus of the next article.</p>
<p>Subscribe to email alerts below so you don't miss it, or follow me on <a href="https://twitter.com/osteel">Twitter</a> where I will share the next posts as soon as they are published.</p>

    <div class="sharethis-inline-share-buttons"></div>

    <section class="info">
      <span class="title">Enjoying the content?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p class="meta">
      <small>
        Last updated by osteel on
          <time datetime="1970-01-01" pubdate>1970-01-01</time>
          :: [
          <a href="https://tech.osteel.me/tag/"></a>
          ]
      </small>
    </p>

  </div>
</div>
      </div>

      <label for="sidebar-checkbox" class="sidebar-toggle"></label>

      <script>
        (function(document) {
          var i = 0;
          // snip empty header rows since markdown can't
          var rows = document.querySelectorAll('tr');
          for(i=0; i<rows.length; i++) {
            var ths = rows[i].querySelectorAll('th');
            var rowlen = rows[i].children.length;
            if (ths.length > 0 && ths.length === rowlen) {
              rows[i].remove();
            }
          }
        })(document);
      </script>

      <script>
        /* Lanyon & Poole are Copyright (c) 2014 Mark Otto. Adapted to Pelican 20141223 and extended a bit by @thomaswilley */
        (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');
          document.addEventListener('click', function(e) {
            var target = e.target;
            if(!checkbox.checked ||
            sidebar.contains(target) ||
            (target === checkbox || target === toggle)) return;
            checkbox.checked = false;
            }, false);
            })(document);
      </script>

      <script type="text/javascript">
        var disqus_shortname = "osteel";
              var disqus_identifier = "/drafts/a-crypto-activity-tracking-tool-part-3-code-design";
              var disqus_url = "https://tech.osteel.me/drafts/a-crypto-activity-tracking-tool-part-3-code-design";
              var disqus_title = "Building a PHP CLI tool using DDD and Event Sourcing. Part 3: code design";
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
      </script>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53994673-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53994673-2');
    ga('send', 'pageview');
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1B7BNCQ79N"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1B7BNCQ79N');
</script>

     </div>
  </body>
</html>