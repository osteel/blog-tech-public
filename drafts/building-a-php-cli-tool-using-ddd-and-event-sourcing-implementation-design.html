<!DOCTYPE html>
<html lang="en">
  <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
    <link rel="shortcut icon" type="image/x-icon" href="https://tech.osteel.me/favicon.ico" />

    <meta name="author" content="Yannick Chenot"/>
    <meta property="og:image" content="https://tech.osteel.me/images/1/dime_01.png" />

    <meta name="google-site-verification" content="KhtQOQ0ZVgZ55KSEoXMOWo_seu_e_JbV6xBk_SuewYI" />

    <meta name="monetization" content="$ilp.uphold.com/miU94ZyFdQ6K">

    <title>Building a PHP CLI tool using DDD and Event Sourcing: implementation design &mdash; osteel's blog</title>

    <meta charset="utf-8" />
    <link href="https://tech.osteel.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Full Atom Feed" />
    <link href="https://tech.osteel.me/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog Full RSS Feed" />
    <link href="https://tech.osteel.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="osteel's blog Atom Feed" />
    <link href="https://tech.osteel.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="osteel's blog RSS Feed" />
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/poole.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/syntax.css"/>
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/lanyon.css"/>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="https://tech.osteel.me/theme/css/styles.css"/>

    <script
      type="text/javascript"
      src="https://platform-api.sharethis.com/js/sharethis.js#property=5e6053b434311400122fd1f8&product=inline-share-buttons"
      async="async">
    </script>




  <meta name="tags" content="" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@osteel">
  <meta name="twitter:creator" content="@osteel">
  <meta name="twitter:title" content="Building a PHP CLI tool using DDD and Event Sourcing: implementation design">
  <meta name="twitter:image" content="https://tech.osteel.me/images/1/dime_01.png">

  </head>

  <body>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="profile">
      <img src="https://www.gravatar.com/avatar/158eb527bb4ceb8e1a84e74b39815b71"/>
    </div>
  </div>

  <section>
    <p>Demat ! I'm Yannick, a senior backend developer based in Brighton, UK.</p>
  </section>

  <section>
    <ul class="sidebar-nav">
    </ul>
  </section>

  <section>
    <h2>Newsletter</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
      <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="Email address" required>
      <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
      <input type="submit" hidden />
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
    </form>
  </section>

  <section>
    <h2>Categories</h2>
    <nav class="sidebar-nav">
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/blogging">Blogging</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/business">Business</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/devops">DevOps</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/laravel">Laravel</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/misc">Misc</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/news">News</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/php">PHP</a>
        <a class="sidebar-nav-item" href="https://tech.osteel.me/category/productivity">Productivity</a>

    </nav>
  </section>

  <section>
    <h2>Search</h2>
    <form class="sidebar-nav-item sidebar-nav" action="https://tech.osteel.me/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
        <input class="form-input" type="text" name="q" placeholder="Search" />
    </form>
  </section>

    <section>
        <h2>Find me</h2>
        <ul class="sidebar-nav">
            <li><a class="sidebar-nav-item" href="https://github.com/osteel" target="_blank">GitHub</a></li>
            <li><a class="sidebar-nav-item" href="https://twitter.com/osteel" target="_blank">Twitter</a></li>
            <li><a class="sidebar-nav-item" href="https://www.linkedin.com/in/yannickchenot" target="_blank">LinkedIn</a></li>
        </ul>
    </section>

  <section>
    <h2>Feeds</h2>
    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">All posts&nbsp;
        [&nbsp;
 <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a>        &nbsp;
 <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a>        &nbsp;]
      </li>
    </ul>
  </section>

  <div class="sidebar-item">
    <p>
    <a href="https://twitter.com/osteel">&copy; @osteel</a> 2023
    </p>
    <p class="tiny-note">
      Powered by <a href="http://getpelican.com">Pelican</a> :: Theme based on <a class="muted" href="https://github.com/thomaswilley/pelicanyan">Pelicanyan</a>
    </p>
  </div>
</div>    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://tech.osteel.me/" title="Home">osteel's blog</a>
            <small>Web development resources</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="posts">
<div class="post">
    <h1 class="post-title">
      Building a PHP CLI tool using DDD and Event Sourcing: implementation design
    </h1>
    <span class="post-date">
      <small>
          Last updated: 1970-01-01 ::
        Published: 1970-01-01
          :: [ <a href="https://github.com/osteel/blog-tech-public/commits/master/drafts/building-a-php-cli-tool-using-ddd-and-event-sourcing-implementation-design.html">history</a> ]
      </small>
    </span>

    <section class="info">
      <span class="title">Been here before?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p><img alt="A pencil on a sheet of paper with drawn lines" src="/images/1/dime_01.png" title="A pencil on a sheet of paper with drawn lines" /></p>
<p class="info"><span class="title">Title</span> Content</p>

<div class="info"><p><span class="title">Title</span> Content</p></div>

<p>Plain code block:</p>
<div class="highlight"><pre><span></span>
</pre></div>


<p>Code block with line numbers:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
</pre></div>
</td></tr></table>

<p>When I started this series, I wasn't sure whether this post would be necessary.</p>
<p>What I'm referring to as "implementation design" here is technically still part of the model, and when searching for inspiration online I found many examples of models featuring some rather specific implementation details.</p>
<p>As per DDD, however, the model is also supposed to be accessible to domain experts, who should be able to validate it. But how can we expect an accountant to know what a repository or an aggregate is?</p>
<p>This is where I decided to draw the line between what non-developers would understand and what they wouldn't, which led me to publishing two articles – one covering the <a href="/posts/building-a-php-cli-tool-using-ddd-and-event-sourcing-the-model" title="Building a PHP CLI tool using DDD and Event Sourcing: the model"><em>abstract</em> model</a> and the other covering the <em>implementation</em> model (this post). This also meant I could go as technical as I wanted in the latter.</p>
<h2 id="in-this-series">In this series</h2>
<ul>
<li><a href="/posts/building-a-php-cli-tool-using-ddd-and-event-sourcing-why" title="Building a PHP CLI tool using DDD and Event Sourcing: why?">Why?</a></li>
<li><a href="/posts/building-a-php-cli-tool-using-ddd-and-event-sourcing-the-domain" title="Building a PHP CLI tool using DDD and Event Sourcing: the domain">The domain</a></li>
<li><a href="/posts/building-a-php-cli-tool-using-ddd-and-event-sourcing-the-model" title="Building a PHP CLI tool using DDD and Event Sourcing: the model">The model</a></li>
<li>Implementation design <strong>⬅️ you are here</strong></li>
</ul>
<h2 id="in-this-post">In this post</h2>
<div class="toc">
<ul>
<li><a href="#in-this-series">In this series</a></li>
<li><a href="#in-this-post">In this post</a></li>
<li><a href="#domain-driven-design">Domain-Driven Design</a></li>
<li><a href="#event-sourcing">Event Sourcing</a></li>
<li><a href="#layered-architecture">Layered Architecture</a></li>
<li><a href="#implementation-design">Implementation design</a></li>
<li><a href="#folder-structure">Folder structure</a></li>
<li><a href="#misc-to-sort-out">Misc (to sort out)</a></li>
<li><a href="#implementation-plan">Implementation plan</a></li>
<li><a href="#closing-thoughts">Closing thoughts</a></li>
</ul>
</div>
<h2 id="domain-driven-design">Domain-Driven Design</h2>
<p>Before I get into the nitty-gritty of the implementation, I need to get some base concepts out of the way. I'm going to start with DDD, so feel free to skip this section if you are already familiar with the topic.</p>
<p><a href="https://martinfowler.com/bliki/DomainDrivenDesign.html" title="DomainDrivenDesign">Domain-Driven Design</a> is both an approach and a set of tools that includes a bunch of object-oriented design patterns. DDD and Object-Oriented Programming (OOP) work well together because they both aim at representing real world concepts and relationships as code. This is also why you will most likely recognise some of the patterns described below, even if you've never worked with DDD:</p>
<p><em>Entity:</em> An entity is a domain object that has a unique identity and a lifecycle that spans multiple interactions with the system. Entities are often referred to as <em>models</em> in non-DDD contexts.</p>
<p><em>Value Object:</em> A value object is a domain object that has no identity and is defined entirely by its properties. Unlike entities, value objects are immutable and can be freely shared and copied between different parts of the system without any side effects.</p>
<p><em>Service:</em> A service is a domain object that encapsulates a specific behavior or process within the domain. Services typically operate on one or more entities or value objects to accomplish a specific goal. Services don't always belong to the domain, however – they can also provide utility for other layers.</p>
<p><em>Factory:</em> A factory is a domain object that encapsulates the creation of other domain objects, such as entities or value objects. Factories are often used to simplify the creation of complex objects or to ensure that objects are created consistently and according to specific rules or constraints.</p>
<p><em>Repository:</em> A repository is a domain object used to save and retrieve entities. A repository doesn't create them (that's the factory's job) but persist them in the storage layer. It contains any logic to retrieve specific objects from that persistence layer, like filters. Repositories are a way to decouple the domain from the underlying storage infrastructure.</p>
<p>There are other DDD patterns that I need to cover, but these belong to a larger pattern worth exploring as a whole – Event Sourcing.</p>
<h2 id="event-sourcing">Event Sourcing</h2>
<p><a href="https://martinfowler.com/eaaDev/EventSourcing.html" title="Event Sourcing">Event Sourcing</a> is a software design pattern whereby the state of a system is stored as a sequence of events, rather than as the current snapshot of that state. Each event represents a change to the system's state and can be used to reconstruct that state at any point in time.</p>
<p>A typical example is a bank statement – instead of displaying the amount currently available on your account and nothing else, the statement lists all the operations performed on the account, which resulted in the current amount.</p>
<p>Event Sourcing is considered a pattern of DDD and it has its own sub-patterns, some of which are briefly covered below:</p>
<p><em>Aggregate:</em> An aggregate is a group of domain objects that are treated as a single, consistent unit within the domain. Aggregates typically consist of one or more entities and/or value objects, and are responsible for enforcing business rules within the domain.</p>
<p><em>Aggregate Root:</em> An aggregate root is a special type of aggregate that serves as the entry point for all operations on the aggregate. The aggregate root is responsible for ensuring the consistency of the entire aggregate, and is the only object that can modify the state of the aggregate.</p>
<p><em>Invariant:</em> An invariant is a business rule. It's a condition or set of conditions that must always be true within a domain. Invariants are typically enforced by aggregates or aggregate roots, and are checked and maintained whenever an event is applied to the system.</p>
<p><em>Event:</em> An event is a record of a change to the system's state. Events are typically immutable and represent a historical record of everything that has happened within the system.</p>
<p><em>Projector:</em> A projector is an object that transforms a stream of events into a separate read model, or projection. Projectors typically subscribe to events and update the projection accordingly.</p>
<p><em>Projection:</em> A projection is the output of a projector, and represents a read-only view of the system's state at a specific point in time. Projections can be used for querying and reporting purposes, and are typically optimised for specific use cases.</p>
<p><em>Reactor:</em> A reactor is an object that reacts to specific events by triggering other actions within the system. The main difference with projectors is that they react to an event only once, even if the event is then replayed to reconstruct the system's state at a specific point in time, for instance.</p>
<h2 id="layered-architecture">Layered Architecture</h2>
<p>The last concept I want to introduce before getting into the implementation details is that of <a href="https://www.baeldung.com/cs/layered-architecture">Layered Architecture</a>.</p>
<p>A layered architecture is a software design pattern that involves breaking a system down into a series of logical layers, each of which is responsible for a specific set of functions or responsibilities within the system. Each layer communicates only with adjacent layers and provides a well-defined interface that can be used by higher-level layers.</p>
<p><img alt="Layered Architecture" src="/images/1/dime_02.png" title="Layered Architecture" /></p>
<p>Here's a brief definition for each layer:</p>
<p><em>Presentation Layer:</em> The presentation layer is responsible for handling user interaction and input, and presenting information back to the user.</p>
<p><em>Application Layer:</em> The application layer orchestrates the interactions between the presentation layer, the domain layer, and the infrastructure layer. It does not contain any business logic.</p>
<p><em>Domain Layer:</em> The domain layer represents the core business concepts and rules/invariants of the system, and is responsible for ensuring the consistency and correctness of the system's behaviour.</p>
<p><em>Infrastructure Layer:</em> The infrastructure layer provides the underlying technical infrastructure and services that support the application, such as databases, messaging systems, and network communication.</p>
<h2 id="implementation-design">Implementation design</h2>
<p>Presentation: console input output, commands (Laravel ones)</p>
<p>Application: jobs, concrete (Eloquent) repositories, providers, exceptions</p>
<p>Domain: entities, aggregates, value objects, services, factories, repository interfaces, consumers (projectors), read models (projections)</p>
<p>Infrastructure: config, storage, database, queues, eloquent models, vendors</p>
<p>In fact, the concept of tax year is a good candidate for an <em>aggregate root</em> – the main entity of an aggregate, a group of domain objects treated as a single unit. In our case, this aggregate would comprise the tax year as well as its relevant taxable events.</p>
<p>As mentioned in the model article, I've decided not to split it in bounded contexts nor modules, which will also simplify the structure of the application (modules would belong to bounded contexts, although there can be modules without bounded contexts as well).</p>
<blockquote>
<p>Imagine our domain use-case contains sending an e-mail, but our domain is not about sending emails. Then we can create an interface that will do the sending e-mail use-case. We use this interface in the domain layer and thus keep the domain layer clean, separated.</p>
<p>Another typical domain interface is a repository.</p>
</blockquote>
<p>– https://medium.com/carvago-development/domain-driven-design-handbook-4d34b069bec4</p>
<p>Value objects: transaction, fiat amount, acquisition, disposal, transfer, airdrop, swap, fee</p>
<p>Enums: currency</p>
<p>https://matthiasnoback.nl/2022/09/is-it-a-dto-or-a-value-object/</p>
<p>Entities/aggregates: tax year, share pooling, nft</p>
<p>Tax year events: capitalGainRecorded, capitalGainReverted, capitalLossRecorded, capitalLossReverted, incomeRecorded, nonAttributableAllowableCostRecorded</p>
<p>Projection for tax years to get current capital gains, income and non-attributable allowable costs without having to replay all events.</p>
<p>Share pooling events: sharePoolingTokenAcquired, sharePoolingTokenDisposedOf, sharePoolingTokenDisposalReverted</p>
<p>Nft events: nftAcquired, nftCostBasisIncreased, nftDisposedOf</p>
<p>Services: TransactionConsumer (breaks down incoming transactions and passes them on to the right handler. E.g. in the case of a transfer, it extracts the fee and makes it a Disposal value object to pass on to the Section104PoolHandler service. The rest of the transaction is passed on to the TransferHandler service), Section104PoolHandler (with rules – same-day, 30-days and section 104 pool), TransferHandler, NftHandler, AirdropHandler</p>
<p>Diagram</p>
<h2 id="folder-structure">Folder structure</h2>
<p>I have read many articles on the topic but the one that influenced me the most in the end was <a href="https://lorisleiva.com/conciliating-laravel-and-ddd">Conciliating Laravel and DDD </a> by <a href="https://twitter.com/lorismatic">Loris Leiva</a>. The main takeaway for me was that it's counterproductive to fight the framework. Keeping this principle in mind, all the layers but the domain one are basically mixed up in the <code>app/</code> folder of the framework – and that's fine.</p>
<p>In practice, that means the only new folder I created at the root is <code>domain/</code>, which I added to the PSR-4 autoload mapping section of <code>composer.json</code>:</p>
<div class="highlight"><pre><span></span><span class="s2">&quot;autoload&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;psr-4&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;App\\&quot;</span><span class="p">:</span> <span class="s2">&quot;app/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Domain\\&quot;</span><span class="p">:</span> <span class="s2">&quot;domain/src/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Database\\Factories\\&quot;</span><span class="p">:</span> <span class="s2">&quot;database/factories/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Database\\Seeders\\&quot;</span><span class="p">:</span> <span class="s2">&quot;database/seeders/&quot;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="err">,</span>
<span class="s2">&quot;autoload-dev&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;psr-4&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;Tests\\&quot;</span><span class="p">:</span> <span class="s2">&quot;tests/&quot;</span><span class="p">,</span>
        <span class="nt">&quot;Domain\\Tests\\&quot;</span><span class="p">:</span> <span class="s2">&quot;domain/tests/&quot;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="err">,</span>
</pre></div>


<p>Note that I also decided to keep the domain-related tests next to the domain, meaning the <code>domain/</code> folder has two subfolders <code>src/</code> and <code>tests/</code>, both mapped above.</p>
<h2 id="misc-to-sort-out">Misc (to sort out)</h2>
<p>Submitting a spreadsheet erases existing records and starts over.</p>
<p>Only two bounded contexts belong to the application – <em>submit</em> and <em>review</em>. Make modules out of them?</p>
<p>Once the job is dispatched, record and report errors at the end instead of interrupting the import?</p>
<p>Use the "sync" driver for events.</p>
<p>dime process transactions.csv</p>
<p>=&gt; do you want to review now?</p>
<p>=&gt; do you want to export now?</p>
<p>dime review</p>
<p>=&gt; please import some transactions first</p>
<p>=&gt; do you want to export now?</p>
<p>dime export</p>
<p>=&gt; please import some transactions first</p>
<h2 id="implementation-plan">Implementation plan</h2>
<p>Start with the aggregates as they can be built in isolation. Then implement the logic connecting them. Finally, build the presentation layer.</p>
<h2 id="closing-thoughts">Closing thoughts</h2>
<p>This post is likely the last one purely within the framework of Domain-Driven Design. The implementation design phase closes the feedback loop opened with the description of the domain and its model, and the three phases will now keep feeding into each other to get a software that represents and addresses more and more accurately identified domain issues.</p>
<p>The following articles will cover more specific aspects of the implementation, like Event Sourcing, Test-Driven Development and developing with Laravel Zero, which will be the focus of the next article.</p>
<p>Subscribe to email alerts below so you don't miss it, or follow me on <a href="https://twitter.com/osteel">Twitter</a> where I will share the next posts as soon as they are published.</p>

    <div class="sharethis-inline-share-buttons"></div>

    <section class="info">
      <span class="title">Enjoying the content?</span>
      <form action="https://osteel.us5.list-manage.com/subscribe/post?u=dda32a39af10ca5ed21d00084&amp;id=e1b6d5529d" method="post" id="subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        <label for="mce-EMAIL">Get notified of future posts by email:</label>
        <input type="email" value="" name="EMAIL" id="mce-EMAIL" class="form-input" placeholder="email address" required>
        <input type="submit" value="Sign up" name="subscribe" id="mc-embedded-subscribe" class="form-button">
        <input type="checkbox" value="" name="group[23889][2]" style="display:none" checked>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dda32a39af10ca5ed21d00084_e1b6d5529d" tabindex="-1" value=""></div>
      </form>
      <p>You can also subscribe to the <a href="https://tech.osteel.me/feeds/rss.xml" rel="subscribe-rss">RSS</a> or <a href="https://tech.osteel.me/feeds/atom.xml" rel="subscribe-atom">Atom</a> feed, or follow me on <a href="https://twitter.com/osteel">Twitter</a>.</p>
    </section>

    <p class="meta">
      <small>
        Last updated by osteel on
          <time datetime="1970-01-01" pubdate>1970-01-01</time>
          :: [
          <a href="https://tech.osteel.me/tag/"></a>
          ]
      </small>
    </p>

  </div>
</div>
      </div>

      <label for="sidebar-checkbox" class="sidebar-toggle"></label>

      <script>
        (function(document) {
          var i = 0;
          // snip empty header rows since markdown can't
          var rows = document.querySelectorAll('tr');
          for(i=0; i<rows.length; i++) {
            var ths = rows[i].querySelectorAll('th');
            var rowlen = rows[i].children.length;
            if (ths.length > 0 && ths.length === rowlen) {
              rows[i].remove();
            }
          }
        })(document);
      </script>

      <script>
        /* Lanyon & Poole are Copyright (c) 2014 Mark Otto. Adapted to Pelican 20141223 and extended a bit by @thomaswilley */
        (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');
          document.addEventListener('click', function(e) {
            var target = e.target;
            if(!checkbox.checked ||
            sidebar.contains(target) ||
            (target === checkbox || target === toggle)) return;
            checkbox.checked = false;
            }, false);
            })(document);
      </script>

      <script type="text/javascript">
        var disqus_shortname = "osteel";
              var disqus_identifier = "/drafts/building-a-php-cli-tool-using-ddd-and-event-sourcing-implementation-design";
              var disqus_url = "https://tech.osteel.me/drafts/building-a-php-cli-tool-using-ddd-and-event-sourcing-implementation-design";
              var disqus_title = "Building a PHP CLI tool using DDD and Event Sourcing: implementation design";
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
      </script>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53994673-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53994673-2');
    ga('send', 'pageview');
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1B7BNCQ79N"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1B7BNCQ79N');
</script>

     </div>
  </body>
</html>